
R version 3.0.2 (2013-09-25) -- "Frisbee Sailing"
Copyright (C) 2013 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> library( "micEconNP" )
Loading required package: np
Loading required package: boot
Loading required package: cubature
Nonparametric Kernel Methods for Mixed Datatypes (version 0.50-1)
[vignette("np_faq",package="np") provides answers to frequently asked questions]
Loading required package: crs
Categorical Regression Splines (version 0.15-18)
[vignette("crs_faq") provides answers to frequently asked questions]
Loading required package: micEcon
Loading required package: miscTools
> 
> ## taken from the documentation of crs(), slightly modified
> 
> set.seed(42)
> ## Example - simulated data
> n <- 250
> num.eval <- 50
> x1 <- runif(n)
> x2 <- runif(n)
> z <- round( runif( n, min = 0, max = 3 ) )
> dgp <- cos( 2 * pi * x1 ) + sin( 2 * pi * x2 ) + z/5
> z <- factor(z)
> y <- dgp + rnorm( n, sd = 0.5 )
> 
> ## Estimate a model with specified degree and bandwidth
> model <- crs( y ~ x1 + x2 + z, degree = c(5,5), segments= c(1,1), lambda = c(0.1),
+    cv = "none", kernel = TRUE, deriv = 1, basis = "additive" )
Working...          Working...          Working...          > summary( model )
Call:
crs.formula(formula = y ~ x1 + x2 + z, degree = c(5, 5), segments = c(1, 
    1), cv = "none", kernel = TRUE, lambda = c(0.1), basis = "additive", 
    deriv = 1)

Kernel Weighting/B-spline Bases Regression Spline

There are 2 continuous predictors
There is 1 categorical predictor
Spline degree/number of segments for x1: 5/1
Spline degree/number of segments for x2: 5/1
Bandwidth for z: 0.1
Model complexity proxy: degree-knots
Knot type: quantiles
Basis type: additive
Training observations: 250
Rank of model frame: 11
Trace of smoother matrix: 31

Residual standard error: 0.4842 on 239 degrees of freedom
Multiple R-squared: 0.8273,   Adjusted R-squared: 0.8201
F-statistic: 34.92 on 30 and 219 DF, p-value: 2.575e-67
Estimation time: 0.1 seconds

> 
> zGrad <- crsGradFactor( model, "z" )
Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          > 
> round( zGrad, 2 )
       z: 0 -> 1 z: 0 -> 2 z: 0 -> 3
  [1,]        NA        NA        NA
  [2,]      0.33        NA        NA
  [3,]        NA      0.19        NA
  [4,]        NA      0.27        NA
  [5,]        NA        NA        NA
  [6,]        NA        NA      0.20
  [7,]        NA      0.52        NA
  [8,]        NA        NA        NA
  [9,]        NA        NA      0.47
 [10,]      0.06        NA        NA
 [11,]        NA        NA        NA
 [12,]        NA      0.57        NA
 [13,]      0.18        NA        NA
 [14,]      0.02        NA        NA
 [15,]        NA      0.24        NA
 [16,]      0.32        NA        NA
 [17,]        NA        NA        NA
 [18,]      0.57        NA        NA
 [19,]     -0.19        NA        NA
 [20,]        NA      0.18        NA
 [21,]        NA      0.52        NA
 [22,]        NA        NA      0.50
 [23,]        NA        NA      0.70
 [24,]        NA        NA        NA
 [25,]        NA      0.16        NA
 [26,]        NA      0.38        NA
 [27,]        NA        NA        NA
 [28,]        NA        NA      0.04
 [29,]     -0.08        NA        NA
 [30,]      0.09        NA        NA
 [31,]        NA        NA      0.23
 [32,]     -0.01        NA        NA
 [33,]        NA      0.37        NA
 [34,]        NA      0.63        NA
 [35,]     -0.08        NA        NA
 [36,]        NA        NA        NA
 [37,]        NA        NA        NA
 [38,]        NA     -0.44        NA
 [39,]        NA      0.36        NA
 [40,]     -0.21        NA        NA
 [41,]        NA     -0.09        NA
 [42,]        NA        NA      0.26
 [43,]        NA      0.59        NA
 [44,]      0.14        NA        NA
 [45,]        NA      0.26        NA
 [46,]        NA      0.57        NA
 [47,]        NA      0.15        NA
 [48,]      0.02        NA        NA
 [49,]      0.37        NA        NA
 [50,]     -0.18        NA        NA
 [51,]        NA        NA      0.18
 [52,]      0.01        NA        NA
 [53,]        NA      0.05        NA
 [54,]        NA        NA        NA
 [55,]        NA        NA        NA
 [56,]        NA        NA        NA
 [57,]        NA        NA      0.22
 [58,]      0.57        NA        NA
 [59,]        NA        NA      0.16
 [60,]        NA      0.42        NA
 [61,]        NA      0.56        NA
 [62,]     -0.05        NA        NA
 [63,]        NA        NA        NA
 [64,]        NA        NA        NA
 [65,]      0.29        NA        NA
 [66,]      0.15        NA        NA
 [67,]        NA      0.15        NA
 [68,]      0.08        NA        NA
 [69,]        NA      0.21        NA
 [70,]        NA      0.36        NA
 [71,]        NA      0.48        NA
 [72,]      0.34        NA        NA
 [73,]        NA        NA      0.62
 [74,]        NA        NA        NA
 [75,]      0.26        NA        NA
 [76,]        NA      0.30        NA
 [77,]        NA        NA        NA
 [78,]        NA        NA        NA
 [79,]        NA      0.24        NA
 [80,]        NA      0.49        NA
 [81,]     -0.15        NA        NA
 [82,]        NA        NA      0.56
 [83,]        NA      0.34        NA
 [84,]        NA      0.42        NA
 [85,]      0.09        NA        NA
 [86,]     -0.05        NA        NA
 [87,]        NA        NA      0.40
 [88,]        NA        NA      0.56
 [89,]      0.27        NA        NA
 [90,]        NA      0.16        NA
 [91,]      0.03        NA        NA
 [92,]        NA        NA      0.83
 [93,]      0.27        NA        NA
 [94,]        NA        NA      0.13
 [95,]        NA      0.08        NA
 [96,]     -0.07        NA        NA
 [97,]        NA      0.09        NA
 [98,]     -0.02        NA        NA
 [99,]        NA        NA        NA
[100,]     -0.11        NA        NA
[101,]     -0.01        NA        NA
[102,]      0.24        NA        NA
[103,]        NA      0.07        NA
[104,]      0.24        NA        NA
[105,]        NA      0.32        NA
[106,]      0.08        NA        NA
[107,]        NA      0.31        NA
[108,]        NA        NA        NA
[109,]     -0.07        NA        NA
[110,]        NA      0.60        NA
[111,]     -0.01        NA        NA
[112,]        NA      0.24        NA
[113,]        NA      0.47        NA
[114,]     -0.25        NA        NA
[115,]        NA        NA      0.47
[116,]        NA        NA      0.45
[117,]        NA        NA        NA
[118,]     -0.12        NA        NA
[119,]      0.02        NA        NA
[120,]      0.20        NA        NA
[121,]      0.16        NA        NA
[122,]        NA      0.24        NA
[123,]      0.01        NA        NA
[124,]        NA      0.54        NA
[125,]        NA        NA        NA
[126,]        NA      0.25        NA
[127,]      0.31        NA        NA
[128,]      0.30        NA        NA
[129,]        NA     -0.08        NA
[130,]      0.04        NA        NA
[131,]      0.05        NA        NA
[132,]     -0.03        NA        NA
[133,]      0.06        NA        NA
[134,]      0.23        NA        NA
[135,]        NA      0.26        NA
[136,]        NA      0.19        NA
[137,]        NA        NA        NA
[138,]        NA      0.36        NA
[139,]        NA        NA      0.39
[140,]        NA      0.48        NA
[141,]      0.27        NA        NA
[142,]        NA        NA        NA
[143,]        NA      0.23        NA
[144,]        NA      0.51        NA
[145,]        NA      0.28        NA
[146,]        NA      0.27        NA
[147,]      0.13        NA        NA
[148,]     -0.03        NA        NA
[149,]        NA        NA      0.32
[150,]        NA        NA      0.87
[151,]     -0.22        NA        NA
[152,]        NA        NA      0.23
[153,]        NA        NA      0.33
[154,]        NA      0.14        NA
[155,]        NA      0.19        NA
[156,]      0.25        NA        NA
[157,]      0.09        NA        NA
[158,]        NA        NA        NA
[159,]      0.44        NA        NA
[160,]      0.06        NA        NA
[161,]        NA      0.59        NA
[162,]        NA        NA      0.47
[163,]      0.21        NA        NA
[164,]        NA      0.01        NA
[165,]      0.22        NA        NA
[166,]        NA      0.36        NA
[167,]        NA      0.39        NA
[168,]      0.09        NA        NA
[169,]        NA        NA      0.55
[170,]      0.29        NA        NA
[171,]      0.27        NA        NA
[172,]        NA      0.16        NA
[173,]        NA        NA        NA
[174,]     -0.06        NA        NA
[175,]        NA        NA        NA
[176,]        NA        NA        NA
[177,]      0.03        NA        NA
[178,]      0.06        NA        NA
[179,]      0.09        NA        NA
[180,]      0.03        NA        NA
[181,]      0.03        NA        NA
[182,]        NA        NA      0.18
[183,]        NA      0.05        NA
[184,]        NA        NA      0.60
[185,]     -0.08        NA        NA
[186,]        NA     -0.21        NA
[187,]        NA        NA        NA
[188,]        NA        NA        NA
[189,]        NA      0.35        NA
[190,]        NA      0.04        NA
[191,]        NA      0.08        NA
[192,]        NA        NA        NA
[193,]        NA        NA      0.48
[194,]        NA        NA      0.39
[195,]        NA        NA        NA
[196,]        NA      0.45        NA
[197,]        NA      0.58        NA
[198,]        NA        NA      0.51
[199,]        NA        NA      0.38
[200,]      0.07        NA        NA
[201,]        NA      0.27        NA
[202,]        NA      0.34        NA
[203,]      0.08        NA        NA
[204,]        NA      0.19        NA
[205,]        NA      0.17        NA
[206,]        NA      0.31        NA
[207,]      0.30        NA        NA
[208,]     -0.03        NA        NA
[209,]      0.09        NA        NA
[210,]        NA     -0.17        NA
[211,]        NA        NA      0.22
[212,]        NA        NA      0.68
[213,]      0.02        NA        NA
[214,]        NA      0.42        NA
[215,]        NA      0.40        NA
[216,]        NA      0.25        NA
[217,]      0.08        NA        NA
[218,]      0.28        NA        NA
[219,]        NA        NA        NA
[220,]        NA      0.07        NA
[221,]      0.01        NA        NA
[222,]        NA     -0.64        NA
[223,]        NA        NA        NA
[224,]     -0.06        NA        NA
[225,]      0.05        NA        NA
[226,]        NA      0.27        NA
[227,]      0.08        NA        NA
[228,]      0.18        NA        NA
[229,]      0.40        NA        NA
[230,]        NA     -0.11        NA
[231,]      0.24        NA        NA
[232,]        NA        NA      0.65
[233,]        NA        NA      0.01
[234,]        NA        NA      0.86
[235,]        NA        NA        NA
[236,]      0.04        NA        NA
[237,]      0.18        NA        NA
[238,]        NA      0.44        NA
[239,]        NA      0.42        NA
[240,]        NA        NA      0.48
[241,]        NA        NA      0.83
[242,]        NA      0.37        NA
[243,]        NA      0.18        NA
[244,]        NA        NA      0.29
[245,]        NA        NA      0.35
[246,]      0.21        NA        NA
[247,]        NA        NA        NA
[248,]        NA      0.28        NA
[249,]        NA        NA      0.48
[250,]     -0.11        NA        NA
> 
> all.equal( rowSums( zGrad, na.rm = TRUE )[ z != 0 ], 
+    model$deriv.mat[ z != 0 , 3 ] )
[1] TRUE
> 
> 
> ## Estimate a model with data-driven degree, segments, and bandwidth
> model2 <- crs( y ~ x1 + x2 + z, deriv = 1, basis = "additive", nmulti = 1 )
Calling NOMAD (Nonsmooth Optimization by Mesh Adaptive Direct Search)

starting point # 0: (  1  1  1  1 0.9148060435 )

                                                fv = 0.9284052                                                 fv = 0.5040737                                                 fv = 0.4733754                                                 fv = 0.4907464                                                 fv = 0.4755582                                                 fv = 0.8436796                                                 fv = 0.3193872                                                 fv = 0.3196758                                                 fv = 0.3299589                                                 fv = 0.3311287                                                 fv = 0.3312773                                                 fv = 0.3170271                                                 fv = 56189206                                                 fv = 0.3400564                                                 fv = 34900571                                                 fv = 1.249397                                                 fv = 0.4679406                                                 fv = 1.340781e+154                                                 fv = 0.3578714                                                 fv = 3.902123                                                 fv = 112.7621                                                 fv = 0.7789152                                                 fv = 0.8720608                                                 fv = 0.3135021                                                 fv = 1.306439                                                 fv = 0.3278215                                                 fv = 1.364578                                                 fv = 0.4260155                                                 fv = 18.51486                                                 fv = 1.305685                                                 fv = 0.7963618                                                 fv = 0.8806096                                                 fv = 0.3245421                                                 fv = 0.8434246                                                 fv = 0.8208645                                                 fv = 1.297391                                                 fv = 0.3180861                                                 fv = 0.3400125                                                 fv = 0.4969897                                                 fv = 0.9339381                                                 fv = 0.3016118                                                 fv = 0.3614815                                                 fv = 0.3105098                                                 fv = 0.3116345                                                 fv = 0.7703446                                                 fv = 0.8489927                                                 fv = 0.3153739                                                 fv = 0.3176382                                                 fv = 0.3348053                                                 fv = 0.3101863                                                 fv = 0.4836478                                                 fv = 0.3197198                                                 fv = 0.3341102                                                 fv = 1.299671                                                 fv = 0.9958729                                                 fv = 0.521156                                                 fv = 4716.459                                                 fv = 2130476                                                 fv = 0.9136942                                                 fv = 1.297391                                                 fv = 1.297391                                                 fv = 0.8045503                                                 fv = 0.3226942                                                 fv = 0.3293365                                                 fv = 0.5294309                                                 fv = 0.9734482                                                 fv = 0.8948219                                                 fv = 0.7480124                                                 fv = 0.2987315                                                 fv = 0.3309835                                                 fv = 101.1483                                                 fv = 0.8094882                                                 fv = 1708983                                                 fv = 0.8308538                                                 fv = 0.3523199                                                 fv = 0.3314677                                                 fv = 0.3263045                                                 fv = 0.8736206                                                 fv = 3347935                                                 fv = 1.297391                                                 fv = 0.3121744                                                 fv = 1229367                                                 fv = 9.9574                                                 fv = 0.3114686                                                 fv = 0.8088115                                                 fv = 0.3029561                                                 fv = 0.3463925                                                 fv = 0.7805233                                                 fv = 0.3145934                                                 fv = 120.1435                                                 fv = 1.122571                                                 fv = 0.3271105                                                 fv = 0.3091684                                                 fv = 0.3164853                                                 fv = 0.3114549                                                 fv = 0.3039553                                                 fv = 0.3171793                                                 fv = 0.3096283                                                 fv = 0.8099131                                                 fv = 17.16087                                                 fv = 0.3045397                                                 fv = 0.3100245                                                 fv = 0.3209758                                                 fv = 0.3003399                                                 fv = 0.2975945                                                 fv = 0.3196217                                                 fv = 0.3566273                                                 fv = 0.3060147                                                 fv = 18.59099                                                 fv = 0.3058461                                                 fv = 0.3079478                                                 fv = 0.3163044                                                 fv = 0.3158648                                                 fv = 0.3063857                                                 fv = 0.8099131                                                 fv = 0.3012443                                                 fv = 0.3134754                                                 fv = 0.3035213                                                 fv = 0.3188845                                                 fv = 0.3043378                                                 fv = 0.3068823                                                 fv = 0.3007554                                                 fv = 0.3077339                                                 fv = 0.3093599                                                 fv = 0.3009344                                                 fv = 0.2988209                                                 fv = 0.2985957                                                 fv = 0.3017982                                                 fv = 0.3062634                                                 fv = 0.3460893                                                 fv = 0.340866                                                 fv = 0.3207732                                                 fv = 0.3134283                                                 fv = 0.3152904                                                 fv = 0.3155602                                                 fv = 0.3085166                                                 fv = 0.3100793                                                 fv = 0.3063296                                                 fv = 0.3085645                                                 fv = 0.3160778                                                 fv = 0.309527                                                 fv = 0.303496                                                 fv = 0.3081438                                                 fv = 0.3142195                                                 fv = 0.3165269                                                 fv = 0.3043331                                                 fv = 0.3069115                                                 fv = 0.3057222                                                 fv = 0.3408395                                                 fv = 0.3465498                                                 fv = 0.2976467                                                 fv = 0.2975602                                                 fv = 0.2975814                                                 fv = 0.2975453                                                 fv = 0.297637                                                 fv = 0.3173276                                                 fv = 0.3200758                                                 fv = 0.3414828                                                 fv = 0.3059205                                                 fv = 0.3155628                                                 fv = 0.3082383                                                 fv = 0.3036272                                                 fv = 0.3026206                                                 fv = 0.3455426                                                 fv = 0.3141425                                                 fv = 0.2992382                                                 fv = 0.3179744                                                 fv = 0.3092432                                                 fv = 0.3039513                                                 fv = 0.3010228                                                 fv = 0.3097141                                                 fv = 0.3103331                                                 fv = 0.3190561                                                 fv = 0.2975448                                                 fv = 0.297547                                                 fv = 0.3046564                                                 fv = 0.3478377                                                 fv = 0.2968413                                                 fv = 0.3196347                                                 fv = 0.2959078                                                 fv = 0.3183752                                                 fv = 0.3070043                                                 fv = 0.2976063                                                 fv = 0.30203                                                 fv = 0.3167889                                                 fv = 0.2996466                                                 fv = 0.2968875                                                 fv = 0.2977843                                                 fv = 0.3072142                                                 fv = 0.3028855                                                 fv = 0.2959321                                                 fv = 0.3187535                                                 fv = 0.3049544                                                 fv = 0.3565123                                                 fv = 0.3282289                                                 fv = 0.2961985                                                 fv = 0.2962649                                                 fv = 0.3147028                                                 fv = 0.3403558                                                 fv = 0.2946535                                                 fv = 0.3059252                                                 fv = 0.3016512                                                 fv = 0.3004702                                                 fv = 0.3018698                                                 fv = 0.305165                                                 fv = 0.3054285                                                 fv = 0.2943715                                                 fv = 0.3574914                                                 fv = 0.3049663                                                 fv = 0.3013926                                                 fv = 0.3560855                                                 fv = 0.295109                                                 fv = 0.3051721                                                 fv = 0.3006456                                                 fv = 0.2978276                                                 fv = 0.3698156                                                 fv = 0.2955129                                                 fv = 0.2965116                                                 fv = 0.2944033                                                 fv = 0.3043943                                                 fv = 0.2951269                                                 fv = 0.3017516                                                 fv = 0.306107                                                 fv = 0.3004555                                                 fv = 0.2933056                                                 fv = 0.3189386                                                 fv = 0.3050546                                                 fv = 0.2960087                                                 fv = 0.2941084                                                 fv = 0.3549932                                                 fv = 0.29371                                                 fv = 0.3564789                                                 fv = 0.2943103                                                 fv = 0.3008226                                                 fv = 0.3053627                                                 fv = 0.2933559                                                 fv = 0.3060731                                                 fv = 0.3673533                                                 fv = 0.3811965                                                 fv = 0.3148581                                                 fv = 0.363315                                                 fv = 0.3009313                                                 fv = 0.2946684                                                 fv = 0.3572267                                                 fv = 0.2933013                                                 fv = 0.2933272                                                 fv = 0.356184                                                 fv = 0.3125716                                                 fv = 0.2937449                                                 fv = 0.3235257                                                 fv = 0.3100845                                                 fv = 0.2936332                                                 fv = 0.2962364                                                 fv = 0.3091306                                                 fv = 0.3017824                                                 fv = 0.3453026                                                 fv = 0.2933036                                                 fv = 0.3057394                                                 fv = 0.3552173                                                 fv = 0.2937301                                                 fv = 0.3563149                                                 fv = 0.3547564                                                 fv = 0.3138616                                                 fv = 0.2942642                                                 fv = 0.3059776                                                 fv = 0.3607884                                                 fv = 0.3009351                                                 fv = 0.3049019                                                 fv = 0.2933125                                                 fv = 0.3439763                                                 fv = 0.3010121                                                 fv = 0.3020427                                                 fv = 0.2933166                                                 fv = 0.3005808                                                 fv = 0.31261                                                 fv = 0.3566887                                                 fv = 0.3007049                                                 fv = 0.2933012                                                 fv = 0.293302                                                 fv = 0.3056076                                                 fv = 0.3684134                                                 fv = 0.2933197                                                 fv = 0.2887314                                                 fv = 0.3073081                                                 fv = 0.2937895                                                 fv = 0.3053484                                                 fv = 0.3002064                                                 fv = 0.2889056                                                 fv = 0.2886893                                                 fv = 0.2898257                                                 fv = 0.2886952                                                 fv = 0.2936886                                                 fv = 0.2936996                                                 fv = 0.3730247                                                 fv = 0.3166477                                                 fv = 0.3008847                                                 fv = 0.2965658                                                 fv = 0.3050814                                                 fv = 0.3055343                                                 fv = 0.301604                                                 fv = 0.3562582                                                 fv = 0.288689                                                 fv = 0.2888441                                                 fv = 0.2969357                                                 fv = 0.3067945                                                 fv = 0.31271                                                 fv = 0.2950636                                                 fv = 0.2937079                                                 fv = 0.3566867                                                 fv = 0.3155702                                                 fv = 0.2897727                                                 fv = 0.301328                                                 fv = 0.2999268                                                 fv = 0.2887065                                                 fv = 0.3060424                                                 fv = 0.3703792                                                 fv = 0.2896771                                                 fv = 0.2940796                                                 fv = 0.2937445                                                 fv = 0.3003739                                                 fv = 0.362089                                                 fv = 0.3004371                                                 fv = 0.2886854                                                 fv = 0.2887206                                                 fv = 0.2887131                                                 fv = 0.2936561                                                 fv = 0.2940605                                                 fv = 0.3705039                                                 fv = 0.3007166                                                 fv = 0.2964792                                                 fv = 0.3019792                                                 fv = 0.3564573                                                 fv = 0.300647                                                 fv = 0.2887101                                                 fv = 0.2886855                                                 fv = 0.3700694                                                 fv = 0.3013221                                                 fv = 0.3146407                                                 fv = 0.3011944                                                 fv = 0.3010509                                                 fv = 0.3107877                                                 fv = 0.3052482                                                 fv = 0.3624684                                                 fv = 0.3056162                                                 fv = 0.2886855                                                 fv = 0.2886896                                                 fv = 0.3063203                                                 fv = 0.2933484                                                 fv = 0.2936864                                                 fv = 0.3702568                                                 fv = 0.2886893                                                 fv = 0.2886854                                                 fv = 0.2886855                                                 fv = 0.3058985                                                 fv = 0.3112564                                                 fv = 0.3628083                                                 fv = 0.3055924                                                 fv = 0.3010474                                                 fv = 0.3141076                                                 fv = 0.3012041                                                 fv = 0.3009718                                                 fv = 0.3693151                                                 fv = 0.2886864                                                 fv = 0.2964895                                                 fv = 0.294067                                                 fv = 0.3568333                                                 fv = 0.3010439                                                 fv = 0.3006899                                                 fv = 0.2886865                                                 fv = 0.2886854                                                 fv = 0.2886855                                                 fv = 0.2886854                                                 fv = 0.2886861                                                 fv = 0.3063658                                                 fv = 0.3007484                                                 fv = 0.2936847                                                 fv = 0.2940664                                                 fv = 0.30104                                                 fv = 0.3568213                                                 fv = 0.2964615                                                 fv = 0.3062567                                                 fv = 0.2886858                                                 fv = 0.2965015                                                 fv = 0.293684                                                 fv = 0.3695986                                                 fv = 0.3060726                                                 fv = 0.301054                                                 fv = 0.3012316                                                 fv = 0.2964731                                                 fv = 0.2933444                                                 fv = 0.3006697                                                 fv = 0.2886855                                                 fv = 0.2886855                                                 fv = 0.2940658                                                 fv = 0.3568515                                                 fv = 0.2936856                                                 fv = 0.3010566                                                 fv = 0.2964795                                                 fv = 0.300712                                                 fv = 0.2933466                                                 fv = 0.2940674                                                 fv = 0.3060625                                                 fv = 0.2886855                                                 fv = 0.2886855                                                 fv = 0.3702694                                                 fv = 0.293686                                                 fv = 0.2933489                                                 fv = 0.3007182                                                 fv = 0.3144716                                                 fv = 0.3058055                                                 fv = 0.2964763                                                 fv = 0.3060704                                                 fv = 0.3020532                                                 fv = 0.3568316                                                 fv = 0.2886854                                                 fv = 0.3007193                                                 fv = 0.2896748                                                 fv = 0.2964791                                                 fv = 0.2936864                                                 fv = 0.3111462                                                 fv = 0.294067                                                 fv = 0.3568361                                                 fv = 0.3007111                                                 fv = 0.2964758                                                 fv = 0.2886854                                                 fv = 0.2886854                                                 fv = 0.2886854                                                 fv = 0.2886854                                                 fv = 0.3568433                                                 fv = 0.311156                                                 fv = 0.3057938                                                 fv = 0.2946589                                                 fv = 0.2940669                                                 fv = 0.3695738                                                 fv = 0.3582111                                                 fv = 0.2964769                                                 fv = 0.2936872                                                 fv = 0.2886854                                                 fv = 0.2886854                                                 fv = 0.2886854                                                 fv = 0.2886855                                                 fv = 0.3010474                                                 fv = 0.3029219                                                 fv = 0.3702541                                                 fv = 0.3796414                                                 fv = 0.302059                                                 fv = 0.3012352                                                 fv = 0.3695752                                                 fv = 0.305791                                                 fv = 0.2886855                                                 fv = 0.2886854                                                 fv = 0.2886854                                                 fv = 0.3010521                                                 fv = 0.2936865                                                 fv = 0.2964784                                                 fv = 0.3007148                                                 fv = 0.294067                                                 fv = 0.3568373                                                 fv = 0.3010476                                                 fv = 0.2886855 run # 0: f=0.2886854489

bb eval : 460
best    : 0.2886854489
worst   : 0.2886854489
solution: x = ( 4 8 1 1 0.08944109618 ) f(x) = 0.2886854489

                                                                      Working...          Working...          Working...          > summary( model2 )
Call:
crs.formula(formula = y ~ x1 + x2 + z, basis = "additive", deriv = 1, 
    nmulti = 1)

Kernel Weighting/B-spline Bases Regression Spline

There are 2 continuous predictors
There is 1 categorical predictor
Spline degree/number of segments for x1: 4/1
Spline degree/number of segments for x2: 8/1
Bandwidth for z: 0.0894411
Model complexity proxy: degree-knots
Knot type: quantiles
Basis type: additive
Training observations: 250
Rank of model frame: 13
Trace of smoother matrix: 38

Residual standard error: 0.4633 on 237 degrees of freedom
Multiple R-squared: 0.8433,   Adjusted R-squared: 0.8353
F-statistic: 30.76 on 37 and 212 DF, p-value: 2.435e-66

Cross-validation score: 0.28868545
Number of multistarts: 1
Estimation time: 3.1 seconds

> 
> zGrad2 <- crsGradFactor( model2, "z" )
Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          > 
> round( zGrad2, 2 )
       z: 0 -> 1 z: 0 -> 2 z: 0 -> 3
  [1,]        NA        NA        NA
  [2,]      0.25        NA        NA
  [3,]        NA      0.08        NA
  [4,]        NA      0.21        NA
  [5,]        NA        NA        NA
  [6,]        NA        NA      0.47
  [7,]        NA      0.58        NA
  [8,]        NA        NA        NA
  [9,]        NA        NA      0.18
 [10,]     -0.07        NA        NA
 [11,]        NA        NA        NA
 [12,]        NA      0.55        NA
 [13,]      0.24        NA        NA
 [14,]      0.04        NA        NA
 [15,]        NA      0.20        NA
 [16,]      0.33        NA        NA
 [17,]        NA        NA        NA
 [18,]      0.34        NA        NA
 [19,]     -0.21        NA        NA
 [20,]        NA      0.04        NA
 [21,]        NA      0.59        NA
 [22,]        NA        NA      0.63
 [23,]        NA        NA      0.62
 [24,]        NA        NA        NA
 [25,]        NA     -0.01        NA
 [26,]        NA      0.46        NA
 [27,]        NA        NA        NA
 [28,]        NA        NA      0.44
 [29,]     -0.06        NA        NA
 [30,]      0.23        NA        NA
 [31,]        NA        NA      0.47
 [32,]      0.22        NA        NA
 [33,]        NA      0.16        NA
 [34,]        NA      1.07        NA
 [35,]      0.01        NA        NA
 [36,]        NA        NA        NA
 [37,]        NA        NA        NA
 [38,]        NA     -0.55        NA
 [39,]        NA      0.61        NA
 [40,]     -0.19        NA        NA
 [41,]        NA      0.07        NA
 [42,]        NA        NA      0.26
 [43,]        NA      0.55        NA
 [44,]      0.18        NA        NA
 [45,]        NA      0.37        NA
 [46,]        NA      0.76        NA
 [47,]        NA      0.63        NA
 [48,]     -0.14        NA        NA
 [49,]      0.27        NA        NA
 [50,]     -0.15        NA        NA
 [51,]        NA        NA      0.47
 [52,]      0.10        NA        NA
 [53,]        NA      0.30        NA
 [54,]        NA        NA        NA
 [55,]        NA        NA        NA
 [56,]        NA        NA        NA
 [57,]        NA        NA      0.31
 [58,]      0.42        NA        NA
 [59,]        NA        NA      0.03
 [60,]        NA      0.38        NA
 [61,]        NA      0.58        NA
 [62,]     -0.07        NA        NA
 [63,]        NA        NA        NA
 [64,]        NA        NA        NA
 [65,]      0.23        NA        NA
 [66,]      0.12        NA        NA
 [67,]        NA      0.14        NA
 [68,]      0.09        NA        NA
 [69,]        NA     -0.06        NA
 [70,]        NA      1.31        NA
 [71,]        NA      0.60        NA
 [72,]      0.34        NA        NA
 [73,]        NA        NA      0.57
 [74,]        NA        NA        NA
 [75,]      0.18        NA        NA
 [76,]        NA     -0.18        NA
 [77,]        NA        NA        NA
 [78,]        NA        NA        NA
 [79,]        NA      0.34        NA
 [80,]        NA      0.83        NA
 [81,]     -0.23        NA        NA
 [82,]        NA        NA     -0.06
 [83,]        NA      0.21        NA
 [84,]        NA      0.58        NA
 [85,]      0.07        NA        NA
 [86,]     -0.12        NA        NA
 [87,]        NA        NA      0.40
 [88,]        NA        NA      0.20
 [89,]      0.28        NA        NA
 [90,]        NA      0.15        NA
 [91,]      0.02        NA        NA
 [92,]        NA        NA      1.26
 [93,]      0.34        NA        NA
 [94,]        NA        NA      0.27
 [95,]        NA      0.34        NA
 [96,]      0.05        NA        NA
 [97,]        NA     -0.21        NA
 [98,]      0.00        NA        NA
 [99,]        NA        NA        NA
[100,]     -0.19        NA        NA
[101,]     -0.05        NA        NA
[102,]      0.16        NA        NA
[103,]        NA      0.26        NA
[104,]      0.15        NA        NA
[105,]        NA      0.64        NA
[106,]      0.10        NA        NA
[107,]        NA      0.22        NA
[108,]        NA        NA        NA
[109,]     -0.14        NA        NA
[110,]        NA      0.71        NA
[111,]     -0.17        NA        NA
[112,]        NA      0.11        NA
[113,]        NA      0.39        NA
[114,]     -0.20        NA        NA
[115,]        NA        NA      0.03
[116,]        NA        NA      0.14
[117,]        NA        NA        NA
[118,]     -0.07        NA        NA
[119,]     -0.01        NA        NA
[120,]      0.22        NA        NA
[121,]      0.30        NA        NA
[122,]        NA      0.33        NA
[123,]     -0.01        NA        NA
[124,]        NA      0.57        NA
[125,]        NA        NA        NA
[126,]        NA      0.16        NA
[127,]      0.25        NA        NA
[128,]      0.34        NA        NA
[129,]        NA      0.13        NA
[130,]      0.08        NA        NA
[131,]      0.08        NA        NA
[132,]     -0.09        NA        NA
[133,]      0.02        NA        NA
[134,]      0.23        NA        NA
[135,]        NA      0.05        NA
[136,]        NA      0.57        NA
[137,]        NA        NA        NA
[138,]        NA      0.07        NA
[139,]        NA        NA      0.25
[140,]        NA      0.58        NA
[141,]      0.28        NA        NA
[142,]        NA        NA        NA
[143,]        NA     -0.01        NA
[144,]        NA      0.32        NA
[145,]        NA      0.41        NA
[146,]        NA      0.37        NA
[147,]      0.11        NA        NA
[148,]      0.04        NA        NA
[149,]        NA        NA      0.30
[150,]        NA        NA      1.03
[151,]     -0.21        NA        NA
[152,]        NA        NA      0.41
[153,]        NA        NA      0.07
[154,]        NA      0.39        NA
[155,]        NA      0.15        NA
[156,]      0.30        NA        NA
[157,]      0.12        NA        NA
[158,]        NA        NA        NA
[159,]      0.50        NA        NA
[160,]      0.05        NA        NA
[161,]        NA      0.67        NA
[162,]        NA        NA      0.14
[163,]     -0.01        NA        NA
[164,]        NA      0.11        NA
[165,]      0.07        NA        NA
[166,]        NA      0.17        NA
[167,]        NA      0.22        NA
[168,]      0.21        NA        NA
[169,]        NA        NA      0.62
[170,]      0.43        NA        NA
[171,]      0.24        NA        NA
[172,]        NA      0.22        NA
[173,]        NA        NA        NA
[174,]      0.01        NA        NA
[175,]        NA        NA        NA
[176,]        NA        NA        NA
[177,]      0.12        NA        NA
[178,]      0.01        NA        NA
[179,]      0.11        NA        NA
[180,]      0.01        NA        NA
[181,]      0.10        NA        NA
[182,]        NA        NA      0.34
[183,]        NA      0.25        NA
[184,]        NA        NA      0.92
[185,]     -0.11        NA        NA
[186,]        NA     -0.31        NA
[187,]        NA        NA        NA
[188,]        NA        NA        NA
[189,]        NA      0.37        NA
[190,]        NA      0.11        NA
[191,]        NA     -0.22        NA
[192,]        NA        NA        NA
[193,]        NA        NA      0.36
[194,]        NA        NA      0.53
[195,]        NA        NA        NA
[196,]        NA      0.46        NA
[197,]        NA      0.43        NA
[198,]        NA        NA      0.69
[199,]        NA        NA      0.07
[200,]      0.20        NA        NA
[201,]        NA      0.61        NA
[202,]        NA      0.52        NA
[203,]      0.17        NA        NA
[204,]        NA     -0.03        NA
[205,]        NA      0.32        NA
[206,]        NA      0.32        NA
[207,]      0.19        NA        NA
[208,]     -0.09        NA        NA
[209,]      0.14        NA        NA
[210,]        NA      0.16        NA
[211,]        NA        NA      0.30
[212,]        NA        NA      0.87
[213,]      0.15        NA        NA
[214,]        NA      0.53        NA
[215,]        NA      0.45        NA
[216,]        NA      0.07        NA
[217,]      0.00        NA        NA
[218,]      0.17        NA        NA
[219,]        NA        NA        NA
[220,]        NA      0.38        NA
[221,]      0.02        NA        NA
[222,]        NA     -1.12        NA
[223,]        NA        NA        NA
[224,]     -0.05        NA        NA
[225,]      0.09        NA        NA
[226,]        NA      0.47        NA
[227,]      0.05        NA        NA
[228,]      0.17        NA        NA
[229,]      0.23        NA        NA
[230,]        NA      0.35        NA
[231,]      0.15        NA        NA
[232,]        NA        NA      0.32
[233,]        NA        NA      0.45
[234,]        NA        NA      0.94
[235,]        NA        NA        NA
[236,]      0.12        NA        NA
[237,]      0.14        NA        NA
[238,]        NA      0.37        NA
[239,]        NA      0.55        NA
[240,]        NA        NA      0.75
[241,]        NA        NA      0.95
[242,]        NA      0.34        NA
[243,]        NA      0.39        NA
[244,]        NA        NA      0.49
[245,]        NA        NA      0.42
[246,]      0.03        NA        NA
[247,]        NA        NA        NA
[248,]        NA      0.20        NA
[249,]        NA        NA      0.25
[250,]      0.08        NA        NA
> 
> all.equal( rowSums( zGrad2, na.rm = TRUE )[ z != 0 ], 
+    model2$deriv.mat[ z != 0 , 3 ] )
[1] TRUE
> 
> proc.time()
   user  system elapsed 
  4.264   0.036   4.293 
