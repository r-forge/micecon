
R version 3.1.1 (2014-07-10) -- "Sock it to Me"
Copyright (C) 2014 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> library( "micEconNP" )
Loading required package: np
Nonparametric Kernel Methods for Mixed Datatypes (version 0.60-2)
[vignette("np_faq",package="np") provides answers to frequently asked questions]
Loading required package: crs
Categorical Regression Splines (version 0.15-22)
[vignette("crs_faq") provides answers to frequently asked questions]
Loading required package: micEcon

If you have questions, suggestions, or comments regarding one of the 'micEcon' packages, please use a forum or 'tracker' at micEcon's R-Forge site:
https://r-forge.r-project.org/projects/micecon/
> 
> ## taken from the documentation of crs(), slightly modified
> 
> set.seed(42)
> ## Example - simulated data
> n <- 250
> num.eval <- 50
> x1 <- runif(n)
> x2 <- runif(n)
> z <- round( runif( n, min = 0, max = 3 ) )
> dgp <- cos( 2 * pi * x1 ) + sin( 2 * pi * x2 ) + z/5
> z <- factor(z)
> y <- dgp + rnorm( n, sd = 0.5 )
> 
> ## Estimate a model with specified degree and bandwidth
> model <- crs( y ~ x1 + x2 + z, degree = c(5,5), segments= c(1,1), lambda = c(0.1),
+    cv = "none", kernel = TRUE, deriv = 1, basis = "additive" )
Working...          Working...          Working...          > summary( model )
Call:
crs.formula(formula = y ~ x1 + x2 + z, degree = c(5, 5), segments = c(1, 
    1), cv = "none", kernel = TRUE, lambda = c(0.1), basis = "additive", 
    deriv = 1)

Kernel Weighting/B-spline Bases Regression Spline

There are 2 continuous predictors
There is 1 categorical predictor
Spline degree/number of segments for x1: 5/1
Spline degree/number of segments for x2: 5/1
Bandwidth for z: 0.1
Model complexity proxy: degree-knots
Knot type: quantiles
Basis type: additive
Training observations: 250
Rank of model frame: 11
Trace of smoother matrix: 31

Residual standard error: 0.4842 on 239 degrees of freedom
Multiple R-squared: 0.8273,   Adjusted R-squared: 0.8201
F-statistic: 34.92 on 30 and 219 DF, p-value: 2.575e-67
Estimation time: 0.1 seconds

> 
> zGrad <- crsGradFactor( model, "z" )
Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          > 
> round( zGrad, 2 )
       z: 0 -> 1 z: 0 -> 2 z: 0 -> 3
  [1,]        NA        NA        NA
  [2,]      0.33        NA        NA
  [3,]        NA      0.19        NA
  [4,]        NA      0.27        NA
  [5,]        NA        NA        NA
  [6,]        NA        NA      0.20
  [7,]        NA      0.52        NA
  [8,]        NA        NA        NA
  [9,]        NA        NA      0.47
 [10,]      0.06        NA        NA
 [11,]        NA        NA        NA
 [12,]        NA      0.57        NA
 [13,]      0.18        NA        NA
 [14,]      0.02        NA        NA
 [15,]        NA      0.24        NA
 [16,]      0.32        NA        NA
 [17,]        NA        NA        NA
 [18,]      0.57        NA        NA
 [19,]     -0.19        NA        NA
 [20,]        NA      0.18        NA
 [21,]        NA      0.52        NA
 [22,]        NA        NA      0.50
 [23,]        NA        NA      0.70
 [24,]        NA        NA        NA
 [25,]        NA      0.16        NA
 [26,]        NA      0.38        NA
 [27,]        NA        NA        NA
 [28,]        NA        NA      0.04
 [29,]     -0.08        NA        NA
 [30,]      0.09        NA        NA
 [31,]        NA        NA      0.23
 [32,]     -0.01        NA        NA
 [33,]        NA      0.37        NA
 [34,]        NA      0.63        NA
 [35,]     -0.08        NA        NA
 [36,]        NA        NA        NA
 [37,]        NA        NA        NA
 [38,]        NA     -0.44        NA
 [39,]        NA      0.36        NA
 [40,]     -0.21        NA        NA
 [41,]        NA     -0.09        NA
 [42,]        NA        NA      0.26
 [43,]        NA      0.59        NA
 [44,]      0.14        NA        NA
 [45,]        NA      0.26        NA
 [46,]        NA      0.57        NA
 [47,]        NA      0.15        NA
 [48,]      0.02        NA        NA
 [49,]      0.37        NA        NA
 [50,]     -0.18        NA        NA
 [51,]        NA        NA      0.18
 [52,]      0.01        NA        NA
 [53,]        NA      0.05        NA
 [54,]        NA        NA        NA
 [55,]        NA        NA        NA
 [56,]        NA        NA        NA
 [57,]        NA        NA      0.22
 [58,]      0.57        NA        NA
 [59,]        NA        NA      0.16
 [60,]        NA      0.42        NA
 [61,]        NA      0.56        NA
 [62,]     -0.05        NA        NA
 [63,]        NA        NA        NA
 [64,]        NA        NA        NA
 [65,]      0.29        NA        NA
 [66,]      0.15        NA        NA
 [67,]        NA      0.15        NA
 [68,]      0.08        NA        NA
 [69,]        NA      0.21        NA
 [70,]        NA      0.36        NA
 [71,]        NA      0.48        NA
 [72,]      0.34        NA        NA
 [73,]        NA        NA      0.62
 [74,]        NA        NA        NA
 [75,]      0.26        NA        NA
 [76,]        NA      0.30        NA
 [77,]        NA        NA        NA
 [78,]        NA        NA        NA
 [79,]        NA      0.24        NA
 [80,]        NA      0.49        NA
 [81,]     -0.15        NA        NA
 [82,]        NA        NA      0.56
 [83,]        NA      0.34        NA
 [84,]        NA      0.42        NA
 [85,]      0.09        NA        NA
 [86,]     -0.05        NA        NA
 [87,]        NA        NA      0.40
 [88,]        NA        NA      0.56
 [89,]      0.27        NA        NA
 [90,]        NA      0.16        NA
 [91,]      0.03        NA        NA
 [92,]        NA        NA      0.83
 [93,]      0.27        NA        NA
 [94,]        NA        NA      0.13
 [95,]        NA      0.08        NA
 [96,]     -0.07        NA        NA
 [97,]        NA      0.09        NA
 [98,]     -0.02        NA        NA
 [99,]        NA        NA        NA
[100,]     -0.11        NA        NA
[101,]     -0.01        NA        NA
[102,]      0.24        NA        NA
[103,]        NA      0.07        NA
[104,]      0.24        NA        NA
[105,]        NA      0.32        NA
[106,]      0.08        NA        NA
[107,]        NA      0.31        NA
[108,]        NA        NA        NA
[109,]     -0.07        NA        NA
[110,]        NA      0.60        NA
[111,]     -0.01        NA        NA
[112,]        NA      0.24        NA
[113,]        NA      0.47        NA
[114,]     -0.25        NA        NA
[115,]        NA        NA      0.47
[116,]        NA        NA      0.45
[117,]        NA        NA        NA
[118,]     -0.12        NA        NA
[119,]      0.02        NA        NA
[120,]      0.20        NA        NA
[121,]      0.16        NA        NA
[122,]        NA      0.24        NA
[123,]      0.01        NA        NA
[124,]        NA      0.54        NA
[125,]        NA        NA        NA
[126,]        NA      0.25        NA
[127,]      0.31        NA        NA
[128,]      0.30        NA        NA
[129,]        NA     -0.08        NA
[130,]      0.04        NA        NA
[131,]      0.05        NA        NA
[132,]     -0.03        NA        NA
[133,]      0.06        NA        NA
[134,]      0.23        NA        NA
[135,]        NA      0.26        NA
[136,]        NA      0.19        NA
[137,]        NA        NA        NA
[138,]        NA      0.36        NA
[139,]        NA        NA      0.39
[140,]        NA      0.48        NA
[141,]      0.27        NA        NA
[142,]        NA        NA        NA
[143,]        NA      0.23        NA
[144,]        NA      0.51        NA
[145,]        NA      0.28        NA
[146,]        NA      0.27        NA
[147,]      0.13        NA        NA
[148,]     -0.03        NA        NA
[149,]        NA        NA      0.32
[150,]        NA        NA      0.87
[151,]     -0.22        NA        NA
[152,]        NA        NA      0.23
[153,]        NA        NA      0.33
[154,]        NA      0.14        NA
[155,]        NA      0.19        NA
[156,]      0.25        NA        NA
[157,]      0.09        NA        NA
[158,]        NA        NA        NA
[159,]      0.44        NA        NA
[160,]      0.06        NA        NA
[161,]        NA      0.59        NA
[162,]        NA        NA      0.47
[163,]      0.21        NA        NA
[164,]        NA      0.01        NA
[165,]      0.22        NA        NA
[166,]        NA      0.36        NA
[167,]        NA      0.39        NA
[168,]      0.09        NA        NA
[169,]        NA        NA      0.55
[170,]      0.29        NA        NA
[171,]      0.27        NA        NA
[172,]        NA      0.16        NA
[173,]        NA        NA        NA
[174,]     -0.06        NA        NA
[175,]        NA        NA        NA
[176,]        NA        NA        NA
[177,]      0.03        NA        NA
[178,]      0.06        NA        NA
[179,]      0.09        NA        NA
[180,]      0.03        NA        NA
[181,]      0.03        NA        NA
[182,]        NA        NA      0.18
[183,]        NA      0.05        NA
[184,]        NA        NA      0.60
[185,]     -0.08        NA        NA
[186,]        NA     -0.21        NA
[187,]        NA        NA        NA
[188,]        NA        NA        NA
[189,]        NA      0.35        NA
[190,]        NA      0.04        NA
[191,]        NA      0.08        NA
[192,]        NA        NA        NA
[193,]        NA        NA      0.48
[194,]        NA        NA      0.39
[195,]        NA        NA        NA
[196,]        NA      0.45        NA
[197,]        NA      0.58        NA
[198,]        NA        NA      0.51
[199,]        NA        NA      0.38
[200,]      0.07        NA        NA
[201,]        NA      0.27        NA
[202,]        NA      0.34        NA
[203,]      0.08        NA        NA
[204,]        NA      0.19        NA
[205,]        NA      0.17        NA
[206,]        NA      0.31        NA
[207,]      0.30        NA        NA
[208,]     -0.03        NA        NA
[209,]      0.09        NA        NA
[210,]        NA     -0.17        NA
[211,]        NA        NA      0.22
[212,]        NA        NA      0.68
[213,]      0.02        NA        NA
[214,]        NA      0.42        NA
[215,]        NA      0.40        NA
[216,]        NA      0.25        NA
[217,]      0.08        NA        NA
[218,]      0.28        NA        NA
[219,]        NA        NA        NA
[220,]        NA      0.07        NA
[221,]      0.01        NA        NA
[222,]        NA     -0.64        NA
[223,]        NA        NA        NA
[224,]     -0.06        NA        NA
[225,]      0.05        NA        NA
[226,]        NA      0.27        NA
[227,]      0.08        NA        NA
[228,]      0.18        NA        NA
[229,]      0.40        NA        NA
[230,]        NA     -0.11        NA
[231,]      0.24        NA        NA
[232,]        NA        NA      0.65
[233,]        NA        NA      0.01
[234,]        NA        NA      0.86
[235,]        NA        NA        NA
[236,]      0.04        NA        NA
[237,]      0.18        NA        NA
[238,]        NA      0.44        NA
[239,]        NA      0.42        NA
[240,]        NA        NA      0.48
[241,]        NA        NA      0.83
[242,]        NA      0.37        NA
[243,]        NA      0.18        NA
[244,]        NA        NA      0.29
[245,]        NA        NA      0.35
[246,]      0.21        NA        NA
[247,]        NA        NA        NA
[248,]        NA      0.28        NA
[249,]        NA        NA      0.48
[250,]     -0.11        NA        NA
> 
> all.equal( rowSums( zGrad, na.rm = TRUE )[ z != 0 ], 
+    model$deriv.mat[ z != 0 , 3 ] )
[1] TRUE
> 
> 
> ## Estimate a model with data-driven degree, segments, and bandwidth
> model2 <- crs( y ~ x1 + x2 + z, deriv = 1, basis = "additive", nmulti = 1 )
Calling NOMAD (Nonsmooth Optimization by Mesh Adaptive Direct Search)

starting point # 0: (  1  1  1  1 0.9148060435 )

                                                fv = 0.9284052                                                 fv = 0.5040737                                                 fv = 0.4733754                                                 fv = 0.4907464                                                 fv = 0.4755582                                                 fv = 0.8436796                                                 fv = 0.5961905                                                 fv = 0.979693                                                 fv = 0.329867                                                 fv = 0.3629182                                                 fv = 0.3353951                                                 fv = 0.9411337                                                 fv = 0.3519794                                                 fv = 0.3425404                                                 fv = 4789.205                                                 fv = 0.3328094                                                 fv = 0.8039226                                                 fv = 0.3420082                                                 fv = 0.3357766                                                 fv = 1258.924                                                 fv = 0.3380479                                                 fv = 0.3424548                                                 fv = 0.3341442                                                 fv = 0.979693                                                 fv = 0.3399466                                                 fv = 0.3346538                                                 fv = 0.3348756                                                 fv = 0.3343495                                                 fv = 0.334743                                                 fv = 0.7026832                                                 fv = 0.3253373                                                 fv = 0.3482013                                                 fv = 0.3273297                                                 fv = 0.3311563                                                 fv = 0.3238402                                                 fv = 0.7784976                                                 fv = 0.3954483                                                 fv = 0.3422739                                                 fv = 0.33215                                                 fv = 0.8429396                                                 fv = 0.332713                                                 fv = 0.3539159                                                 fv = 0.3440247                                                 fv = 0.3382398                                                 fv = 0.3259961                                                 fv = 0.5049036                                                 fv = 0.5072327                                                 fv = 0.4888197                                                 fv = 0.3403077                                                 fv = 0.3237113                                                 fv = 1.306439                                                 fv = 0.5243521                                                 fv = 0.3555272                                                 fv = 0.5194567                                                 fv = 0.936173                                                 fv = 0.9516063                                                 fv = 0.3336813                                                 fv = 0.8516852                                                 fv = 0.4710723                                                 fv = 0.3419096                                                 fv = 0.320788                                                 fv = 0.3362498                                                 fv = 0.3347228                                                 fv = 0.3268075                                                 fv = 461.5225                                                 fv = 0.3306521                                                 fv = 0.8508741                                                 fv = 0.3605658                                                 fv = 0.8469475                                                 fv = 0.3261994                                                 fv = 0.326675                                                 fv = 0.3260762                                                 fv = 0.326796                                                 fv = 0.3769372                                                 fv = 0.4754617                                                 fv = 0.3917393                                                 fv = 0.3109654                                                 fv = 1.299671                                                 fv = 0.3568227                                                 fv = 0.3418724                                                 fv = 0.3302858                                                 fv = 0.5178895                                                 fv = 0.4129144                                                 fv = 0.3650947                                                 fv = 0.8658902                                                 fv = 0.3234706                                                 fv = 0.3109106                                                 fv = 0.4603139                                                 fv = 0.4829627                                                 fv = 0.3983956                                                 fv = 0.4968224                                                 fv = 0.5898224                                                 fv = 0.4736581                                                 fv = 0.3212376                                                 fv = 0.8857691                                                 fv = 0.3590142                                                 fv = 0.3799029                                                 fv = 0.3512683                                                 fv = 0.8650554                                                 fv = 0.3219369                                                 fv = 0.8857691                                                 fv = 0.3333812                                                 fv = 0.3460722                                                 fv = 0.3268661                                                 fv = 0.3347534                                                 fv = 0.3456094                                                 fv = 0.4180504                                                 fv = 0.3412246                                                 fv = 0.3165742                                                 fv = 0.3379039                                                 fv = 0.8377794                                                 fv = 0.6609862                                                 fv = 0.3957324                                                 fv = 0.293922                                                 fv = 0.2938473                                                 fv = 0.3149847                                                 fv = 0.291936                                                 fv = 0.3207112                                                 fv = 0.3111732                                                 fv = 0.2985055                                                 fv = 0.3071407                                                 fv = 0.3141196                                                 fv = 0.2940473                                                 fv = 0.3269245                                                 fv = 0.2991559                                                 fv = 0.301834                                                 fv = 0.3049253                                                 fv = 0.3075326                                                 fv = 0.3179311                                                 fv = 0.8536089                                                 fv = 1.299671                                                 fv = 0.2944608                                                 fv = 0.2951009                                                 fv = 0.3070537                                                 fv = 0.3137407                                                 fv = 0.2967262                                                 fv = 0.3505723                                                 fv = 0.8532887                                                 fv = 0.2921929                                                 fv = 0.2932711                                                 fv = 0.3251775                                                 fv = 0.3073075                                                 fv = 0.3534303                                                 fv = 0.3128381                                                 fv = 1.294245                                                 fv = 0.2922924                                                 fv = 0.2925377                                                 fv = 0.3389802                                                 fv = 0.3012433                                                 fv = 0.3289411                                                 fv = 0.8605177                                                 fv = 0.2920615                                                 fv = 0.292205                                                 fv = 0.3141052                                                 fv = 0.2985192                                                 fv = 0.8537273                                                 fv = 0.3262073                                                 fv = 0.2920141                                                 fv = 0.3070432                                                 fv = 0.3012863                                                 fv = 0.8424902                                                 fv = 0.3141415                                                 fv = 0.3123081                                                 fv = 0.8541147                                                 fv = 0.2919655                                                 fv = 0.2941233                                                 fv = 0.3071343                                                 fv = 0.3157843                                                 fv = 0.2907372                                                 fv = 0.3002688                                                 fv = 0.2871881                                                 fv = 0.3412451                                                 fv = 0.3055516                                                 fv = 0.3636024                                                 fv = 0.836064                                                 fv = 0.2876736                                                 fv = 0.2951316                                                 fv = 0.8489532                                                 fv = 0.2873019                                                 fv = 0.3572412                                                 fv = 0.8541326                                                 fv = 0.8405665                                                 fv = 0.3087429                                                 fv = 0.2909479                                                 fv = 0.2965582                                                 fv = 0.287216                                                 fv = 0.3412934                                                 fv = 0.3630624                                                 fv = 0.2840943                                                 fv = 0.3041139                                                 fv = 0.2906041                                                 fv = 0.8377698                                                 fv = 0.3055337                                                 fv = 0.2996571                                                 fv = 0.2843174                                                 fv = 0.3438271                                                 fv = 0.2841487                                                 fv = 0.2906428                                                 fv = 0.3055453                                                 fv = 0.298645                                                 fv = 0.2841936                                                 fv = 0.3844802                                                 fv = 0.8557252                                                 fv = 0.2841188                                                 fv = 0.3124294                                                 fv = 0.2986425                                                 fv = 0.3218799                                                 fv = 0.3441868                                                 fv = 0.3087641                                                 fv = 0.8360916                                                 fv = 0.2841078                                                 fv = 0.2906634                                                 fv = 0.2989834                                                 fv = 0.2881641                                                 fv = 0.8377145                                                 fv = 0.2909153                                                 fv = 0.854139                                                 fv = 0.2841004                                                 fv = 0.290666                                                 fv = 0.305538                                                 fv = 0.3284504                                                 fv = 0.298644                                                 fv = 0.2909127                                                 fv = 0.8541468                                                 fv = 0.2840976                                                 fv = 0.8476443                                                 fv = 0.3055342                                                 fv = 0.3147765                                                 fv = 0.3572659                                                 fv = 0.840765                                                 fv = 0.3284479                                                 fv = 0.2840958                                                 fv = 0.3057943                                                 fv = 0.2997505                                                 fv = 0.3055337                                                 fv = 0.3057824                                                 fv = 0.2871487                                                 fv = 0.8541439 run # 0: f=0.2840942521

bb eval : 238
best    : 0.2840942521
worst   : 0.2840942521
solution: x = ( 4 1 1 4 0.1226806641 ) f(x) = 0.2840942521

                                                                      Working...          Working...          Working...          > summary( model2 )
Call:
crs.formula(formula = y ~ x1 + x2 + z, basis = "additive", deriv = 1, 
    nmulti = 1)

Kernel Weighting/B-spline Bases Regression Spline

There are 2 continuous predictors
There is 1 categorical predictor
Spline degree/number of segments for x1: 4/1
Spline degree/number of segments for x2: 1/4
Bandwidth for z: 0.1226807
Model complexity proxy: degree-knots
Knot type: quantiles
Basis type: additive
Training observations: 250
Rank of model frame: 9
Trace of smoother matrix: 24

Residual standard error: 0.4881 on 241 degrees of freedom
Multiple R-squared: 0.8229,   Adjusted R-squared: 0.8171
F-statistic: 45.61 on 23 and 226 DF, p-value: 8.18e-72

Cross-validation score: 0.28409425
Number of multistarts: 1
Estimation time: 1.8 seconds

> 
> zGrad2 <- crsGradFactor( model2, "z" )
Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          > 
> round( zGrad2, 2 )
       z: 0 -> 1 z: 0 -> 2 z: 0 -> 3
  [1,]        NA        NA        NA
  [2,]      0.29        NA        NA
  [3,]        NA      0.24        NA
  [4,]        NA      0.26        NA
  [5,]        NA        NA        NA
  [6,]        NA        NA      0.16
  [7,]        NA      0.29        NA
  [8,]        NA        NA        NA
  [9,]        NA        NA      0.18
 [10,]     -0.02        NA        NA
 [11,]        NA        NA        NA
 [12,]        NA      0.32        NA
 [13,]      0.20        NA        NA
 [14,]      0.08        NA        NA
 [15,]        NA      0.20        NA
 [16,]      0.22        NA        NA
 [17,]        NA        NA        NA
 [18,]      0.41        NA        NA
 [19,]     -0.16        NA        NA
 [20,]        NA      0.25        NA
 [21,]        NA      0.45        NA
 [22,]        NA        NA      0.35
 [23,]        NA        NA      0.46
 [24,]        NA        NA        NA
 [25,]        NA      0.24        NA
 [26,]        NA      0.35        NA
 [27,]        NA        NA        NA
 [28,]        NA        NA      0.29
 [29,]     -0.10        NA        NA
 [30,]      0.13        NA        NA
 [31,]        NA        NA      0.24
 [32,]      0.09        NA        NA
 [33,]        NA      0.34        NA
 [34,]        NA      0.28        NA
 [35,]      0.01        NA        NA
 [36,]        NA        NA        NA
 [37,]        NA        NA        NA
 [38,]        NA     -0.08        NA
 [39,]        NA      0.46        NA
 [40,]     -0.10        NA        NA
 [41,]        NA      0.14        NA
 [42,]        NA        NA      0.15
 [43,]        NA      0.54        NA
 [44,]      0.09        NA        NA
 [45,]        NA      0.30        NA
 [46,]        NA      0.48        NA
 [47,]        NA      0.29        NA
 [48,]     -0.08        NA        NA
 [49,]      0.20        NA        NA
 [50,]     -0.10        NA        NA
 [51,]        NA        NA      0.31
 [52,]      0.00        NA        NA
 [53,]        NA      0.11        NA
 [54,]        NA        NA        NA
 [55,]        NA        NA        NA
 [56,]        NA        NA        NA
 [57,]        NA        NA      0.19
 [58,]      0.37        NA        NA
 [59,]        NA        NA      0.24
 [60,]        NA      0.37        NA
 [61,]        NA      0.30        NA
 [62,]     -0.04        NA        NA
 [63,]        NA        NA        NA
 [64,]        NA        NA        NA
 [65,]      0.29        NA        NA
 [66,]      0.15        NA        NA
 [67,]        NA      0.21        NA
 [68,]      0.11        NA        NA
 [69,]        NA      0.26        NA
 [70,]        NA      0.08        NA
 [71,]        NA      0.41        NA
 [72,]      0.23        NA        NA
 [73,]        NA        NA      0.39
 [74,]        NA        NA        NA
 [75,]      0.21        NA        NA
 [76,]        NA      0.26        NA
 [77,]        NA        NA        NA
 [78,]        NA        NA        NA
 [79,]        NA      0.19        NA
 [80,]        NA      0.57        NA
 [81,]     -0.18        NA        NA
 [82,]        NA        NA      0.93
 [83,]        NA      0.26        NA
 [84,]        NA      0.31        NA
 [85,]      0.07        NA        NA
 [86,]     -0.15        NA        NA
 [87,]        NA        NA      0.33
 [88,]        NA        NA      0.42
 [89,]      0.17        NA        NA
 [90,]        NA      0.23        NA
 [91,]     -0.07        NA        NA
 [92,]        NA        NA      0.92
 [93,]      0.21        NA        NA
 [94,]        NA        NA      0.28
 [95,]        NA      0.31        NA
 [96,]      0.01        NA        NA
 [97,]        NA      0.12        NA
 [98,]     -0.08        NA        NA
 [99,]        NA        NA        NA
[100,]     -0.16        NA        NA
[101,]     -0.13        NA        NA
[102,]      0.20        NA        NA
[103,]        NA      0.03        NA
[104,]      0.14        NA        NA
[105,]        NA      0.39        NA
[106,]      0.05        NA        NA
[107,]        NA      0.21        NA
[108,]        NA        NA        NA
[109,]     -0.14        NA        NA
[110,]        NA      0.61        NA
[111,]     -0.11        NA        NA
[112,]        NA      0.24        NA
[113,]        NA      0.41        NA
[114,]     -0.17        NA        NA
[115,]        NA        NA      0.16
[116,]        NA        NA      0.20
[117,]        NA        NA        NA
[118,]     -0.04        NA        NA
[119,]     -0.09        NA        NA
[120,]      0.20        NA        NA
[121,]      0.10        NA        NA
[122,]        NA      0.29        NA
[123,]     -0.08        NA        NA
[124,]        NA      0.29        NA
[125,]        NA        NA        NA
[126,]        NA      0.18        NA
[127,]      0.31        NA        NA
[128,]      0.17        NA        NA
[129,]        NA     -0.01        NA
[130,]     -0.03        NA        NA
[131,]      0.12        NA        NA
[132,]     -0.14        NA        NA
[133,]     -0.06        NA        NA
[134,]      0.23        NA        NA
[135,]        NA      0.26        NA
[136,]        NA      0.23        NA
[137,]        NA        NA        NA
[138,]        NA      0.18        NA
[139,]        NA        NA      0.15
[140,]        NA      0.26        NA
[141,]      0.20        NA        NA
[142,]        NA        NA        NA
[143,]        NA      0.17        NA
[144,]        NA      0.46        NA
[145,]        NA      0.20        NA
[146,]        NA      0.26        NA
[147,]      0.13        NA        NA
[148,]      0.05        NA        NA
[149,]        NA        NA      0.29
[150,]        NA        NA      0.69
[151,]     -0.03        NA        NA
[152,]        NA        NA      0.30
[153,]        NA        NA      0.15
[154,]        NA      0.19        NA
[155,]        NA      0.25        NA
[156,]      0.12        NA        NA
[157,]      0.12        NA        NA
[158,]        NA        NA        NA
[159,]      0.28        NA        NA
[160,]     -0.04        NA        NA
[161,]        NA      0.49        NA
[162,]        NA        NA      0.19
[163,]      0.05        NA        NA
[164,]        NA      0.01        NA
[165,]      0.01        NA        NA
[166,]        NA      0.19        NA
[167,]        NA      0.38        NA
[168,]      0.10        NA        NA
[169,]        NA        NA      0.48
[170,]      0.25        NA        NA
[171,]      0.08        NA        NA
[172,]        NA      0.17        NA
[173,]        NA        NA        NA
[174,]     -0.09        NA        NA
[175,]        NA        NA        NA
[176,]        NA        NA        NA
[177,]      0.04        NA        NA
[178,]     -0.05        NA        NA
[179,]      0.10        NA        NA
[180,]      0.01        NA        NA
[181,]      0.10        NA        NA
[182,]        NA        NA      0.24
[183,]        NA      0.10        NA
[184,]        NA        NA      0.56
[185,]     -0.07        NA        NA
[186,]        NA      0.12        NA
[187,]        NA        NA        NA
[188,]        NA        NA        NA
[189,]        NA      0.14        NA
[190,]        NA      0.07        NA
[191,]        NA      0.02        NA
[192,]        NA        NA        NA
[193,]        NA        NA      0.40
[194,]        NA        NA      0.40
[195,]        NA        NA        NA
[196,]        NA      0.35        NA
[197,]        NA      0.35        NA
[198,]        NA        NA      0.40
[199,]        NA        NA      0.13
[200,]      0.03        NA        NA
[201,]        NA      0.35        NA
[202,]        NA      0.29        NA
[203,]      0.15        NA        NA
[204,]        NA      0.16        NA
[205,]        NA      0.13        NA
[206,]        NA      0.33        NA
[207,]      0.23        NA        NA
[208,]     -0.06        NA        NA
[209,]      0.11        NA        NA
[210,]        NA      0.05        NA
[211,]        NA        NA      0.22
[212,]        NA        NA      0.47
[213,]      0.04        NA        NA
[214,]        NA      0.29        NA
[215,]        NA      0.25        NA
[216,]        NA      0.24        NA
[217,]     -0.03        NA        NA
[218,]      0.21        NA        NA
[219,]        NA        NA        NA
[220,]        NA      0.33        NA
[221,]     -0.04        NA        NA
[222,]        NA     -0.09        NA
[223,]        NA        NA        NA
[224,]      0.01        NA        NA
[225,]      0.05        NA        NA
[226,]        NA      0.27        NA
[227,]      0.10        NA        NA
[228,]      0.16        NA        NA
[229,]      0.25        NA        NA
[230,]        NA      0.02        NA
[231,]      0.21        NA        NA
[232,]        NA        NA      0.38
[233,]        NA        NA      0.25
[234,]        NA        NA      0.73
[235,]        NA        NA        NA
[236,]      0.02        NA        NA
[237,]      0.13        NA        NA
[238,]        NA      0.49        NA
[239,]        NA      0.24        NA
[240,]        NA        NA      0.62
[241,]        NA        NA      0.56
[242,]        NA      0.25        NA
[243,]        NA      0.26        NA
[244,]        NA        NA      0.36
[245,]        NA        NA      0.25
[246,]      0.07        NA        NA
[247,]        NA        NA        NA
[248,]        NA      0.23        NA
[249,]        NA        NA      0.19
[250,]      0.11        NA        NA
> 
> all.equal( rowSums( zGrad2, na.rm = TRUE )[ z != 0 ], 
+    model2$deriv.mat[ z != 0 , 3 ] )
[1] TRUE
> 
> 
> ## test crsCv()
> cv2 <- crsCv( model2 )
Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Working...          Warning messages:
1: In gsl.bs.default(newx, degree = attr(object, "degree"), nbreak = attr(object,  :
  some 'x' values beyond boundary knots may cause ill-conditioned bases
2: In gsl.bs.default(newx, degree = attr(object, "degree"), nbreak = attr(object,  :
  some 'x' values beyond boundary knots may cause ill-conditioned bases
3: In gsl.bs.default(newx, degree = attr(object, "degree"), nbreak = attr(object,  :
  some 'x' values beyond boundary knots may cause ill-conditioned bases
4: In gsl.bs.default(newx, degree = attr(object, "degree"), nbreak = attr(object,  :
  some 'x' values beyond boundary knots may cause ill-conditioned bases
> round( c( cv2 ), 3 )
[1] 0.284
> round( attr( cv2, "err" ), 3 )
  [1] -0.223 -0.246 -0.595  0.000  0.716  1.580 -0.658 -0.051  0.878 -0.102
 [11] -0.141 -0.278  0.520  0.764  0.198  0.210  0.119 -0.282 -0.111 -0.234
 [21]  0.509  0.376  0.760 -0.052  0.558  0.622 -0.617  0.408 -0.023 -0.234
 [31] -0.437 -0.119  0.072  1.013 -0.719 -0.576 -0.149 -0.830 -0.341 -0.489
 [41] -0.368 -0.790  0.101  0.095  0.766  0.508 -0.558  0.058 -0.134  0.446
 [51] -0.012 -0.435  0.196  0.075 -0.100  1.080  0.011 -0.703 -0.564 -0.129
 [61]  0.352 -0.404 -0.418 -0.985  0.480  0.646  0.258  0.778 -0.477  0.919
 [71] -0.412 -0.014 -0.215 -0.348 -0.046 -0.657  0.140 -0.186  0.045  0.291
 [81]  0.060  0.131  0.228  1.486 -0.348  0.447  1.073  0.356 -0.695 -0.488
 [91]  0.083  0.703  0.193 -0.658 -0.376 -0.089 -0.612  0.486 -1.519  0.274
[101] -0.154 -0.589 -0.051 -0.081  0.600  0.128 -0.874 -0.890 -0.774  0.311
[111] -0.133  0.235 -0.924  0.053  0.520 -0.018  0.080  0.031  0.766 -0.335
[121]  0.166  0.453 -0.452 -0.094  0.067  0.730  0.291  0.184  0.182 -0.323
[131] -0.120 -0.515 -0.352 -0.501  0.425  0.523 -0.397 -0.403  0.234  1.068
[141]  0.867 -1.199 -0.185  0.591  0.333  0.784 -0.163  0.648  0.103  1.422
[151]  0.427 -0.678 -0.020  0.146 -1.051 -1.055 -0.552 -0.101  0.323 -0.018
[161]  0.047  0.049 -0.472  1.296 -0.677 -0.155 -0.387  0.227  0.811 -0.100
[171]  0.653  0.282 -0.451  0.099  0.370 -1.243  0.124  0.068  0.613  0.343
[181]  0.192  1.035 -0.860  0.240 -0.662  0.307  0.087  0.355  0.081 -0.843
[191] -0.900  0.228  0.088 -0.309 -0.158 -0.482 -0.317 -0.463 -0.699 -0.188
[201]  0.540  0.887  0.158 -0.011  0.614 -0.038 -0.013 -0.860 -0.789  0.341
[211] -0.584  0.449 -0.801 -0.133 -0.140  0.049  0.210 -0.039 -0.284 -0.093
[221]  0.197 -0.144  0.637 -0.678  0.353 -0.223  0.006  0.379  0.314 -0.129
[231]  0.550 -0.955  0.590 -0.427 -0.866 -1.065  0.092  1.072  0.002  0.229
[241]  0.775 -0.551  0.546  0.213  0.134  0.322  0.364 -0.245  0.341 -0.453
> all.equal( cv2, model2$cv.min, check.attributes = FALSE )
[1] "Mean relative difference: 0.001138623"
> 
> 
> proc.time()
   user  system elapsed 
 23.605   0.172  23.825 
