
R version 3.1.1 (2014-07-10) -- "Sock it to Me"
Copyright (C) 2014 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> library( "micEconNP" )
Loading required package: np
Nonparametric Kernel Methods for Mixed Datatypes (version 0.60-2)
[vignette("np_faq",package="np") provides answers to frequently asked questions]
Loading required package: crs
Categorical Regression Splines (version 0.15-22)
[vignette("crs_faq") provides answers to frequently asked questions]
Loading required package: micEcon

If you have questions, suggestions, or comments regarding one of the 'micEcon' packages, please use a forum or 'tracker' at micEcon's R-Forge site:
https://r-forge.r-project.org/projects/micecon/
> 
> set.seed( 123 )
> n <- 250
> x1 <- runif(n)
> x2 <- rnorm(n)
> z1 <- runif(n)
> z2 <- runif(n, min=-2, max=2)
> y <- sin( 5 * z1 ) + x1 * exp( z2 ) + x2 * ( z1^2 + z2 ) + rnorm( n, sd = 0.2 )
> model <- npscoef( y ~ x1 + x2 | z1 + z2, beta = TRUE )
Multistart 1 of 2... fval: 0.2375161               fval: 0.2538366               fval: 0.2619561               fval: 0.232562              fval: 0.2327495               fval: 0.2149809               fval: 0.2092429               fval: 0.1910715               fval: 0.178994              fval: 0.1570708               fval: 0.1726802               fval: 0.1628752               fval: 0.1518711               fval: 0.1507032               fval: 0.7037957               fval: 0.1464669               fval: 0.1967755               fval: 0.19665             fval: 0.1430833               fval: 0.1759859               fval: 0.1432459               fval: 0.147708              fval: 0.14271             fval: 0.1486375               fval: 0.1422127               fval: 0.1438853               fval: 0.1423774               fval: 0.142687              fval: 0.1423102               fval: 0.1427721               fval: 0.1422033               fval: 0.1421907               fval: 0.1424134               fval: 0.142289              fval: 0.1421613               fval: 0.1423566               fval: 0.1421557               fval: 0.1422122               fval: 0.1421597               fval: 0.1421662               fval: 0.1421542               fval: 0.1421674               fval: 0.1421533               fval: 0.1421682               fval: 0.1421523               fval: 0.1421535               fval: 0.1421525               fval: 0.1421544               fval: 0.1421524               fval: 0.1421524               fval: 0.1421522               fval: 0.1421532               fval: 0.1421521               fval: 0.1421524               fval: 0.1421522               fval: 0.1421522               fval: 0.1421521               fval: 0.1421522               fval: 0.1421521               fval: 0.1421522               fval: 0.1421521               fval: 0.1421522               fval: 0.1421521               fval: 0.1421521               fval: 0.1421521               Multistart 2 of 2... fval: 0.2797412               fval: 0.3242623               fval: 0.3096993               fval: 0.2929093               fval: 0.2881448               fval: 0.259213              fval: 0.2395448               fval: 0.2304782               fval: 0.20923             fval: 0.1750461               fval: 0.1453666               fval: 0.1685267               fval: 0.1516532               fval: 0.2057244               fval: 0.1455798               fval: 0.1501997               fval: 0.1441815               fval: 0.1532559               fval: 0.1425063               fval: 0.1615116               fval: 0.1429143               fval: 0.1429198               fval: 0.1423484               fval: 0.1426634               fval: 0.1422603               fval: 0.1425679               fval: 0.142236              fval: 0.1432936               fval: 0.1421703               fval: 0.1422817               fval: 0.1421946               fval: 0.1421642               fval: 0.1422415               fval: 0.1422959               fval: 0.1421575               fval: 0.1421579               fval: 0.1421529               fval: 0.1421785               fval: 0.142154              fval: 0.1421683               fval: 0.1421527               fval: 0.142155              fval: 0.1421525               fval: 0.142154              fval: 0.1421522               fval: 0.1421544               fval: 0.1421522               fval: 0.1421524               fval: 0.1421522               fval: 0.1421525               fval: 0.1421521               fval: 0.1421522               fval: 0.1421521               fval: 0.1421522               fval: 0.1421521               fval: 0.1421522               fval: 0.1421521               fval: 0.1421522               fval: 0.1421521               fval: 0.1421522               fval: 0.1421521                                    > 
> print( model )

Smooth Coefficient Model
Regression data: 250 training points, in 2 variable(s)
                     z1        z2
Bandwidth(s): 0.0983929 0.1865147

Bandwidth Type: Fixed

Continuous Kernel Type: Second-Order Gaussian
No. Continuous Explanatory Vars.: 2

> summary( model )

Smooth Coefficient Model
Regression data: 250 training points, in 2 variable(s)

                     z1        z2
Bandwidth(s): 0.0983929 0.1865147

Bandwidth Type: Fixed

Residual standard error: 0.2159275
R-squared: 0.9867547

Continuous Kernel Type: Second-Order Gaussian
No. Continuous Explanatory Vars.: 2

> round( coef( model ), 3 )
       Intercept     x1     x2
  [1,]     1.018  0.160 -0.945
  [2,]     0.822  1.295  0.346
  [3,]     0.377  0.804 -1.441
  [4,]     0.004  4.950  1.567
  [5,]     0.582  3.776  1.545
  [6,]     0.428  1.439  0.167
  [7,]     0.672  2.821  1.420
  [8,]    -0.921  0.566 -0.170
  [9,]     0.739 -0.264 -1.789
 [10,]     0.456  1.469 -0.147
 [11,]     0.423  1.301  0.105
 [12,]     0.981  0.064 -0.572
 [13,]     0.086  0.241 -0.851
 [14,]     0.288  1.735  0.321
 [15,]    -0.008  0.340 -1.520
 [16,]     0.650  2.893  0.969
 [17,]     0.610  1.142  0.198
 [18,]     0.761  1.680  0.755
 [19,]    -0.230  0.822  0.233
 [20,]     0.040  0.113 -0.471
 [21,]    -1.413  1.341  0.552
 [22,]    -0.501  2.859  1.996
 [23,]    -0.139  1.322  0.715
 [24,]    -0.875  1.173  0.094
 [25,]     0.480  3.623  1.107
 [26,]     0.936  0.180 -0.745
 [27,]     0.799  1.408  0.396
 [28,]     0.637  1.247 -0.023
 [29,]     0.118  0.056 -0.507
 [30,]    -0.599  1.243  0.662
 [31,]     0.970  0.132 -1.077
 [32,]    -0.643  1.156  0.655
 [33,]     0.281  0.928 -0.339
 [34,]     0.033 -0.096 -1.014
 [35,]    -0.692  1.729  0.967
 [36,]     0.279  1.865  0.467
 [37,]     0.436  0.736 -1.473
 [38,]     0.512  0.958  0.214
 [39,]     0.669  1.155 -0.146
 [40,]    -1.373  1.276  0.515
 [41,]    -0.917  3.865  2.057
 [42,]     0.647  1.579  1.356
 [43,]     0.486  1.491 -0.124
 [44,]     0.209  1.831  0.408
 [45,]    -0.558  0.331 -0.340
 [46,]     0.645  0.358 -1.563
 [47,]     0.297  1.042 -0.359
 [48,]     1.132 -0.443 -1.844
 [49,]     0.873  4.190  1.596
 [50,]     0.863  6.521  1.857
 [51,]     0.662  2.159  1.161
 [52,]     0.959  3.599  1.462
 [53,]     0.454  5.000  1.979
 [54,]     0.518  0.950  0.124
 [55,]     0.782  1.320  0.178
 [56,]    -1.003  0.551 -0.113
 [57,]     0.674  1.632  0.908
 [58,]     0.430  0.461 -0.635
 [59,]    -0.517  0.472 -0.359
 [60,]     0.317  1.360  1.705
 [61,]    -0.042  3.299  0.796
 [62,]    -0.257  0.152 -0.724
 [63,]     0.836  0.390 -0.717
 [64,]    -0.989  1.065  0.079
 [65,]    -0.405  0.093 -1.174
 [66,]     0.258  2.944  0.700
 [67,]     0.780  1.385  0.191
 [68,]     0.369  0.756 -1.505
 [69,]     0.330  6.071  2.058
 [70,]     0.104  1.571  0.671
 [71,]     0.310  2.138  1.895
 [72,]     1.032  3.805  1.492
 [73,]     0.488  4.092  1.624
 [74,]    -0.887  3.456  2.110
 [75,]    -0.394  1.682  1.094
 [76,]     0.351  1.688  0.432
 [77,]     0.563  0.471 -0.621
 [78,]     0.781 -0.461 -1.844
 [79,]     0.759  0.974 -0.149
 [80,]    -0.728  1.249 -0.080
 [81,]     0.317  0.459 -0.407
 [82,]    -0.542  0.331 -0.611
 [83,]     0.563  0.620 -0.456
 [84,]    -0.617  1.233 -0.002
 [85,]     0.389  1.700  1.846
 [86,]     0.307  0.212 -0.474
 [87,]    -0.110 -0.082 -1.050
 [88,]    -0.080 -0.008 -1.359
 [89,]     1.039  3.320  1.320
 [90,]     0.468  1.105 -0.167
 [91,]    -0.888  3.519  2.098
 [92,]    -0.264  0.002 -1.190
 [93,]     0.053  0.030 -1.147
 [94,]     0.387  0.709 -1.521
 [95,]     0.642  1.787  1.459
 [96,]     0.890  2.816  1.138
 [97,]    -2.874  8.427  3.707
 [98,]     0.372  1.460  0.409
 [99,]     0.942  0.217 -0.902
[100,]     0.454  0.650 -1.306
[101,]     1.003  3.327  1.340
[102,]     0.133  1.609  1.811
[103,]    -1.050  0.679 -0.105
[104,]     0.221  1.611  1.868
[105,]     0.511  4.297  1.642
[106,]     0.365  1.838  0.337
[107,]    -0.938  1.586  0.905
[108,]     0.612  5.286  2.021
[109,]     0.545  5.455  2.024
[110,]    -0.666  1.979  1.510
[111,]     0.569  0.424 -1.556
[112,]     0.141  4.189  1.233
[113,]    -0.138  1.126  0.333
[114,]     0.552  0.979 -0.159
[115,]     0.201  0.245 -0.376
[116,]     1.021  0.109 -1.027
[117,]     0.338  1.451 -0.213
[118,]     0.604  5.284  2.031
[119,]     0.387  0.451 -0.530
[120,]     0.171  1.537  0.681
[121,]     0.494  0.600 -1.291
[122,]     0.516  0.607 -1.316
[123,]    -0.036  1.753  1.781
[124,]     0.487  0.461 -0.387
[125,]    -0.817  0.538 -0.745
[126,]    -0.144  0.010 -1.289
[127,]     0.573  5.136  2.167
[128,]    -0.235  1.376  0.671
[129,]    -0.836  0.511 -0.851
[130,]    -0.048  1.408  0.687
[131,]     0.567  1.038  0.118
[132,]    -0.896  3.666  2.078
[133,]     0.264  1.341  1.656
[134,]     0.615  1.162  0.231
[135,]     0.038  1.684  1.790
[136,]    -0.742  2.940  2.068
[137,]     0.666  0.850 -0.199
[138,]     0.989  0.207 -0.889
[139,]     0.671  1.444  0.066
[140,]     0.962  0.157 -1.004
[141,]     0.583  3.577  1.516
[142,]    -0.752  1.215  0.045
[143,]    -0.131  0.004 -1.253
[144,]     0.323  6.018  2.033
[145,]    -0.619  0.381 -0.344
[146,]    -0.757  1.207  0.051
[147,]     0.364  1.502  0.416
[148,]     0.789  1.569  0.672
[149,]     0.272  0.636 -0.510
[150,]    -0.584  0.328 -0.830
[151,]    -1.622  6.575  2.595
[152,]     0.444  1.104  0.791
[153,]    -0.409  2.397  1.929
[154,]     0.225  5.367  1.830
[155,]    -0.200  1.358  0.607
[156,]     0.472  0.942 -0.209
[157,]    -0.347  0.042 -1.212
[158,]    -0.965  4.339  2.002
[159,]    -0.733  0.928  0.561
[160,]     0.349  0.705 -1.284
[161,]     0.351  0.298 -0.419
[162,]     0.306  0.743 -1.297
[163,]    -1.153  1.053  0.481
[164,]     0.199  0.195 -0.577
[165,]     0.736  0.301 -1.573
[166,]    -0.825  0.320 -0.903
[167,]     0.572  1.119  1.355
[168,]     0.423  0.368 -0.454
[169,]     0.726  0.446 -1.436
[170,]     0.842  6.335  1.944
[171,]    -0.863  1.071  0.162
[172,]     0.293  0.732 -0.390
[173,]     0.807  1.737  0.741
[174,]    -1.525  6.438  2.559
[175,]    -0.250  0.169 -0.575
[176,]    -0.226  1.369  0.642
[177,]     0.836  2.649  1.191
[178,]     0.307  1.143 -0.148
[179,]     0.641  0.188 -1.664
[180,]    -0.598  1.812  1.080
[181,]    -0.529 -0.166 -1.129
[182,]     0.726  0.343 -1.209
[183,]    -0.312  1.908  1.570
[184,]     0.534  3.912  1.589
[185,]    -0.882  3.463  2.101
[186,]     0.405  0.720 -1.513
[187,]     0.418  1.044 -0.168
[188,]    -0.752  3.209  2.043
[189,]    -0.473  2.060  1.724
[190,]     0.497  1.099  0.320
[191,]    -0.892  0.430 -0.710
[192,]     0.212  1.821  0.553
[193,]     0.657  1.211 -0.057
[194,]     0.803  2.964  1.335
[195,]     0.867 -0.540 -1.860
[196,]     0.510  0.606 -1.310
[197,]     0.644  4.648  1.692
[198,]     0.769  0.251 -1.580
[199,]     0.725  6.045  2.085
[200,]     0.994  0.429 -0.255
[201,]     0.552  3.928  1.576
[202,]     0.520  4.916  1.871
[203,]    -1.549  1.583  0.641
[204,]    -0.142  3.398  0.760
[205,]     0.562  1.567  0.055
[206,]    -2.985  8.550  3.732
[207,]    -0.119  0.065 -1.304
[208,]     0.268  0.897 -1.447
[209,]     0.854  3.162  1.350
[210,]     0.396  1.832  0.371
[211,]     0.475  1.089 -0.088
[212,]     0.722  6.129  2.186
[213,]     0.132  0.051 -0.545
[214,]     0.543  1.183 -0.052
[215,]    -0.796  0.386 -0.970
[216,]     0.544  3.380  1.509
[217,]     0.351  1.063 -0.179
[218,]     0.521  3.390  1.056
[219,]    -0.508  0.318 -0.497
[220,]     0.479  5.909  2.028
[221,]    -0.853  1.108 -0.085
[222,]     0.500  0.950  0.030
[223,]    -0.634  0.336 -0.988
[224,]     0.957  4.402  1.609
[225,]     0.926  5.781  1.840
[226,]    -0.093  0.047 -1.359
[227,]    -1.507  1.550  0.647
[228,]     0.263  0.643 -1.196
[229,]     0.925  4.023  1.562
[230,]     0.419  1.813  0.310
[231,]     0.279  0.607 -1.592
[232,]    -0.268  0.257 -0.441
[233,]    -0.983  0.687 -0.096
[234,]     0.097  1.187  0.752
[235,]    -0.884  0.508 -0.166
[236,]    -0.297 -0.012 -1.255
[237,]     0.507  0.475 -1.587
[238,]     0.278  2.886  0.646
[239,]     0.783  5.308  1.875
[240,]     0.615  0.587 -0.543
[241,]     0.725 -0.096 -1.742
[242,]     0.855  0.256 -0.721
[243,]     0.580  0.791  0.922
[244,]     0.671  1.129 -0.072
[245,]     0.523  3.221  1.509
[246,]    -0.748  0.487 -0.257
[247,]    -0.058  1.367  0.696
[248,]     0.654  0.303 -1.593
[249,]    -0.345  0.227 -0.617
[250,]     0.213  3.024  0.786
> 
> grad <- npscoefGrad( model )
> round( grad, 3 )
, , 1

         [,1]   [,2]   [,3]   [,4]
  [1,]  0.364  0.177  0.447  0.123
  [2,]  2.048 -0.540  1.282  1.924
  [3,]  1.340 -1.287  0.103  0.822
  [4,]  1.124 -0.060 -0.480  1.533
  [5,] -0.336 -2.755 -0.166 -2.914
  [6,] -3.053  0.352  1.414 -0.994
  [7,] -2.121 -2.140  1.049 -2.777
  [8,] -1.485 -0.214  0.959 -1.637
  [9,]  1.193 -0.477 -0.254  1.037
 [10,]  1.725 -0.416  0.558  0.390
 [11,] -3.646  1.043  1.039 -1.474
 [12,]  4.386 -5.060  0.272  1.696
 [13,] -3.069 -2.024  1.832 -3.084
 [14,] -3.233 -0.011  1.968  0.519
 [15,]  0.020 -6.744  1.958 -3.502
 [16,]  2.578 -0.570  0.335  2.300
 [17,]  0.896  2.609 -0.450  1.656
 [18,] -1.158 -0.619  0.961 -2.695
 [19,] -2.667 -6.603 -0.078 -4.713
 [20,] -5.015  1.448  0.019 -3.663
 [21,] -4.247  4.987  1.033 -0.359
 [22,] -6.585  9.180  0.642 -1.163
 [23,] -4.432  2.044 -0.494 -3.462
 [24,] -1.832 -1.759  1.447 -0.541
 [25,]  3.667 -2.326  0.130  1.974
 [26,]  2.293 -2.081  0.087  0.887
 [27,] -2.204  3.137  1.379  0.564
 [28,] -0.391 -0.948  0.908 -0.653
 [29,] -3.922 -0.298 -0.241 -3.765
 [30,] -3.092 -0.573  1.134 -3.312
 [31,]  1.717 -0.953  0.753  0.589
 [32,] -3.483 -0.159  1.498 -2.783
 [33,]  0.738  2.322  0.534  2.143
 [34,] -2.201 -0.717  1.034 -1.761
 [35,] -2.336  0.479  1.438 -2.863
 [36,] -3.255  0.378  2.047 -0.919
 [37,]  1.524 -1.454  0.039  0.381
 [38,]  0.629  0.359  0.071  0.618
 [39,]  1.986 -3.020  0.056  1.207
 [40,] -4.115  4.576  1.199 -3.555
 [41,]  0.060 -0.197 -0.072  0.011
 [42,] -1.020 -7.051  2.621 -2.275
 [43,]  0.797  0.830  0.429  0.932
 [44,] -3.209 -0.367  2.075 -2.272
 [45,] -3.597  2.148  2.066 -2.507
 [46,] -3.622  3.764  0.733 -3.258
 [47,]  0.468  5.467  1.050  1.810
 [48,] -4.019  8.237  3.235 -0.291
 [49,] -4.105  4.512  1.383  0.039
 [50,] -0.969  5.537  2.354  2.036
 [51,] -0.550 -8.712  0.907 -1.943
 [52,] -2.065  0.872  0.580 -1.657
 [53,]  2.124 -1.352 -1.886  0.459
 [54,]  0.860  0.764 -0.084  0.917
 [55,]  1.361  0.626  0.890  1.305
 [56,] -0.904  0.493  0.535 -1.371
 [57,] -0.717 -6.461  1.497  0.350
 [58,] -4.277  1.560  1.962 -3.788
 [59,] -4.643  2.248  1.342 -3.793
 [60,] -3.880  3.570  1.724 -2.950
 [61,]  3.862 -4.037 -0.141  1.205
 [62,] -3.539  1.488  1.485 -1.749
 [63,] -3.131  3.426  2.015 -1.645
 [64,] -1.406 -1.462  0.942 -1.097
 [65,] -3.900  2.878  0.670 -1.890
 [66,]  4.624 -5.464  0.161  2.208
 [67,] -0.502  2.265  1.230  0.934
 [68,]  0.939 -0.799 -0.168  0.274
 [69,] -2.087 -0.724 -1.616 -1.216
 [70,] -1.816 -3.093  0.683 -4.071
 [71,] -2.830 -4.376  2.457 -1.225
 [72,] -1.094  0.766  0.921 -0.059
 [73,]  0.783 -5.168 -0.355 -2.443
 [74,] -0.069 -0.602  0.267 -0.233
 [75,] -5.896  6.099  0.955 -4.129
 [76,]  0.503  1.901 -0.090  0.724
 [77,] -3.808  1.650  2.416 -0.011
 [78,]  1.842 -1.376 -0.442  1.116
 [79,] -0.255 -0.268  0.375 -0.146
 [80,] -3.664 -0.914  0.747 -4.075
 [81,] -0.121  4.051  0.020  0.856
 [82,] -3.885  3.070  1.696 -3.171
 [83,] -1.335 -0.764  1.515 -2.555
 [84,] -3.479 -2.686  2.040 -2.228
 [85,] -2.348 -2.217  2.214 -2.696
 [86,] -1.921 -3.855 -0.072 -3.606
 [87,] -3.494  1.724  0.491 -1.676
 [88,] -1.214 -1.659  1.185 -1.236
 [89,] -0.200  1.701  1.522  0.522
 [90,]  0.995  2.450  0.759  0.670
 [91,] -0.132 -0.351  0.259  0.257
 [92,] -3.202  1.687  0.449 -2.299
 [93,] -0.154 -4.786  2.046 -3.277
 [94,]  0.898 -0.726 -0.202  0.671
 [95,] -1.631 -5.470  2.458 -6.542
 [96,]  1.321  2.660  2.829  0.197
 [97,] -8.160  8.846  1.490 -0.319
 [98,] -0.030  1.668  0.241  0.394
 [99,]  1.944 -1.431 -0.086  1.215
[100,]  2.591 -2.736  0.488  1.014
[101,] -0.849  0.850  0.686 -0.298
[102,] -3.659  3.847  0.341 -2.619
[103,] -0.814  0.445  0.402 -0.884
[104,] -3.554  2.988  0.507 -0.253
[105,] -0.315 -3.497 -0.730 -1.263
[106,] -3.294  1.369  1.960  1.757
[107,] -1.958  1.316 -0.043 -0.751
[108,]  1.349  0.594 -1.775  1.329
[109,]  0.774  0.545 -1.074  1.791
[110,] -0.929 -1.179  0.774 -1.547
[111,] -4.620  4.096  0.513 -1.465
[112,]  0.494  0.845 -0.055  0.759
[113,] -2.351 -7.349 -0.366 -2.951
[114,] -2.145  1.313  0.078 -0.875
[115,] -4.926  0.557  0.023 -4.542
[116,]  1.113 -0.493  0.658  0.523
[117,]  1.893  1.597  1.265  2.135
[118,]  1.171  0.682 -1.699 -0.720
[119,] -1.972 -2.356  1.265 -4.790
[120,] -1.743 -3.248  0.822 -3.204
[121,]  2.741 -2.901  0.552  1.913
[122,]  2.451 -2.596  0.565  1.563
[123,] -3.702  3.936  0.087 -2.609
[124,] -1.365 -2.495  1.253 -2.746
[125,] -2.579  2.058  1.538 -1.071
[126,] -1.177 -1.351  0.982 -2.876
[127,]  0.342 -0.130 -0.524  0.617
[128,] -3.333 -0.165 -0.355 -3.226
[129,] -1.419  0.616  1.347 -1.210
[130,] -2.935 -0.784 -0.274 -3.914
[131,]  0.672  2.301 -0.320  2.126
[132,] -0.258  0.155  0.180  0.074
[133,] -4.623  5.196  1.495 -0.183
[134,]  1.072  2.363 -0.403  2.860
[135,] -3.740  4.064  0.158 -1.864
[136,] -2.119  3.180  1.243 -0.669
[137,] -2.822  2.706  0.363 -0.776
[138,] -0.415  0.927  0.668  0.346
[139,]  1.391  0.662  0.975  3.309
[140,]  2.107 -1.207  0.274  2.205
[141,] -0.950 -2.079  0.384 -1.004
[142,] -2.424 -2.532  1.897 -3.713
[143,] -1.095 -1.535  0.981 -2.834
[144,] -2.395 -0.009 -0.994 -2.010
[145,] -3.295  2.324  2.148 -1.145
[146,] -2.393 -2.490  1.891 -1.371
[147,]  0.006  1.799  0.204  0.633
[148,] -1.128  0.497  1.037 -0.380
[149,] -0.841  6.848 -1.123  2.409
[150,] -4.741  4.371  1.247 -0.480
[151,] -0.588  1.690  0.491  0.625
[152,] -1.437 -4.299  0.844 -3.428
[153,] -4.577  6.805  1.236 -1.845
[154,]  0.419 -5.374 -0.951 -1.312
[155,] -2.046 -3.736 -0.416 -2.471
[156,] -2.144  1.050  0.248 -2.149
[157,] -3.382  2.028  0.574 -1.799
[158,]  0.193 -0.100 -0.469 -0.009
[159,] -5.318  2.414  1.850 -4.736
[160,]  2.142 -1.498  0.176  1.837
[161,] -0.419  4.923 -0.079  2.044
[162,]  1.620 -0.570  0.026  1.424
[163,] -6.035  6.107  1.669  0.674
[164,] -1.885 -3.927 -0.217 -3.309
[165,]  1.070 -0.747  0.371  0.867
[166,] -0.321 -1.437  1.368  0.511
[167,] -1.791 -3.733  3.679 -0.677
[168,] -1.465 -3.285  1.003 -1.042
[169,] -0.215 -0.432  0.177 -0.495
[170,] -1.368  1.116  1.892  2.717
[171,] -2.512 -1.294  1.914 -3.200
[172,] -0.277  5.676  0.478  1.659
[173,] -0.697  1.190  1.018 -1.045
[174,] -4.936  6.351  3.110 -0.129
[175,] -3.317  1.280  1.577 -0.490
[176,] -2.573 -2.027 -0.390 -3.547
[177,] -1.478  2.473  0.500 -0.933
[178,] -4.301  2.653 -0.178 -2.728
[179,]  0.954 -0.367 -0.133  0.773
[180,] -3.245  2.154  1.500 -2.648
[181,] -2.707  0.656  2.650 -1.278
[182,]  2.731 -2.369  0.775  0.431
[183,] -4.014  4.118  0.550 -0.981
[184,]  0.349 -4.251 -0.155 -0.970
[185,] -0.248 -0.184  0.344  0.342
[186,]  1.113 -1.010 -0.149  0.433
[187,] -2.906  1.749 -0.010 -2.450
[188,] -2.894  4.625  0.968 -1.954
[189,] -1.437  0.770  1.348 -1.545
[190,]  0.357  0.719  0.191  0.938
[191,]  0.181 -3.050  1.194  0.184
[192,] -2.588 -1.300  1.830 -3.200
[193,] -0.193 -0.961  0.823 -2.176
[194,] -1.376 -3.842  0.963 -2.135
[195,]  2.712 -2.247 -0.474  0.174
[196,]  2.528 -2.692  0.566  1.406
[197,] -4.589  4.977  1.212 -1.088
[198,] -0.158  1.072  0.733 -0.433
[199,] -1.609 -2.414  1.203 -1.182
[200,] -0.926  2.573  0.426  0.325
[201,]  0.099 -3.595 -0.385 -1.023
[202,]  3.743 -3.323 -2.414  0.692
[203,] -3.234  3.930  0.392 -0.623
[204,]  3.769 -3.887 -0.439  1.180
[205,] -0.312 -0.467  1.336 -0.490
[206,]  0.299 -0.048 -0.130  0.125
[207,] -0.515 -2.772  1.356 -3.136
[208,]  0.899 -0.590 -0.110  0.808
[209,] -1.850 -1.947  0.837 -0.910
[210,] -3.547  1.966  1.984 -2.460
[211,] -2.876  1.485  0.024 -2.209
[212,] -0.392 -4.672  0.661 -2.476
[213,] -3.146 -1.405 -0.270 -3.396
[214,]  0.040  3.885 -0.091  2.581
[215,] -1.251  0.177  1.688 -1.415
[216,] -1.521 -2.263  1.076 -2.436
[217,] -3.727  2.343  0.054 -2.850
[218,]  2.849 -1.394  0.098  2.443
[219,] -3.164  2.029  2.008 -1.386
[220,] -3.285  1.879  0.150 -1.566
[221,] -1.880 -1.862  0.513 -3.305
[222,]  0.978  0.871 -0.089  1.806
[223,] -3.978  3.631  1.304 -2.078
[224,]  2.242 -3.577 -1.050  0.809
[225,] -0.450  3.411  1.141 -0.475
[226,] -0.813 -2.472  1.358 -0.412
[227,] -3.717  4.413  0.376 -2.357
[228,]  1.086  0.783 -0.414  1.701
[229,] -3.432  3.495  1.251 -0.845
[230,] -3.266  1.924  1.887 -3.190
[231,] -4.595  2.633 -0.457 -3.120
[232,] -5.290  3.211  1.179 -3.429
[233,] -0.651 -1.128  0.538 -1.280
[234,] -4.382  2.041 -0.550 -2.906
[235,] -2.358  1.173  1.178  0.976
[236,] -2.768  0.962  0.623 -2.514
[237,]  0.972 -0.669 -0.214  0.700
[238,]  4.481 -5.702  0.414 -0.149
[239,]  3.001 -0.216 -1.853  1.069
[240,] -2.334  0.888  1.958 -0.020
[241,]  1.032 -0.244 -0.137  0.928
[242,]  4.123 -4.750 -0.178  0.910
[243,] -1.653 -4.057  0.960 -3.257
[244,] -0.667 -0.459  0.759 -0.307
[245,] -1.743 -2.662  1.453 -3.243
[246,] -2.779  0.549  1.500  1.245
[247,] -3.359  0.077 -0.393 -2.679
[248,] -3.965  4.224  0.676 -0.184
[249,] -3.334  1.508  1.649 -0.514
[250,]  4.598 -5.004 -0.033  0.944

, , 2

         [,1]   [,2]   [,3]   [,4]
  [1,] -0.419  0.648  0.705 -0.692
  [2,] -0.174  0.887  1.022  0.766
  [3,]  0.230 -0.113  0.768  0.243
  [4,]  0.460  4.142  3.592  0.663
  [5,] -0.471  3.306  0.641  2.592
  [6,] -1.373  2.697  1.449  0.843
  [7,] -0.262  4.985  0.161  2.443
  [8,] -0.481  1.002  0.203  0.422
  [9,] -0.895  2.772  0.863  0.269
 [10,]  0.196  0.239  0.249 -0.206
 [11,] -0.948  2.109  1.415  2.671
 [12,]  1.227 -1.693  2.052 -2.537
 [13,] -0.486  0.512  1.629  1.066
 [14,] -1.206  2.102  1.342  2.560
 [15,] -0.839  0.697  0.247 -1.123
 [16,]  0.650  2.220  0.616  3.079
 [17,]  0.155  0.247  1.127 -0.079
 [18,]  0.059  2.601  1.009 -1.418
 [19,]  0.442  0.119  1.783 -2.219
 [20,] -0.219  1.609  0.983 -0.258
 [21,] -0.412  0.963  0.625  0.112
 [22,] -1.853  4.714  0.425  0.792
 [23,]  0.719 -1.122  0.682  0.469
 [24,]  0.185 -1.152  0.940  1.015
 [25,] -2.384  7.483  1.563  0.510
 [26,]  0.475 -1.309  1.736  0.915
 [27,]  0.440 -0.397  1.357  1.267
 [28,] -0.606  2.241  0.829  1.000
 [29,]  0.327  0.682  0.837 -0.319
 [30,]  0.002  1.701  0.426  0.202
 [31,]  0.935 -0.644  0.896  0.064
 [32,]  0.380  1.718  0.493  2.207
 [33,]  0.349  1.015  0.543  0.847
 [34,] -0.075  0.403  1.192  1.411
 [35,]  0.150  2.275  2.601 -0.768
 [36,]  0.398 -0.699  1.053  1.172
 [37,] -0.152  0.649  0.832 -0.532
 [38,]  0.147  0.482  0.942 -0.936
 [39,] -1.317  3.118  0.420  1.037
 [40,] -0.917  1.284  0.735 -0.927
 [41,] -0.380  4.337 -0.574  0.068
 [42,]  0.336  2.051  1.357  2.051
 [43,]  0.089  0.370  0.225  0.133
 [44,] -0.725  1.253  1.193  0.354
 [45,] -0.083  0.129  0.195  0.008
 [46,]  0.390  0.066  0.235  0.349
 [47,] -0.513  2.421  0.671  0.095
 [48,] -1.321  1.779  0.581 -0.512
 [49,] -0.428  3.755  0.606  1.861
 [50,] -0.598  4.464  0.415  2.923
 [51,]  0.456  1.070  1.697 -1.354
 [52,] -0.465  3.285  1.080  1.028
 [53,]  2.175 -0.141  1.782  2.616
 [54,]  0.221  0.101  1.274  0.789
 [55,]  0.954 -1.081  1.219 -0.211
 [56,] -0.134  0.126 -0.014 -0.093
 [57,] -0.246  2.724  0.944  1.294
 [58,]  0.222  0.520  0.840  0.320
 [59,] -1.663  2.807  0.786  0.169
 [60,]  0.451  1.119  1.112  0.608
 [61,]  2.515 -2.594  1.007  0.591
 [62,] -1.044  1.283  1.440  0.676
 [63,] -0.332  0.514  1.351 -0.020
 [64,] -0.345  1.121  1.184  0.856
 [65,] -0.246  0.445  0.719 -0.242
 [66,]  1.397 -0.945  1.600  1.316
 [67,]  0.945 -1.127  1.164 -0.346
 [68,] -0.773  1.731  0.646  0.694
 [69,]  1.223  0.344  0.806  0.774
 [70,]  1.471 -2.644  0.747 -0.670
 [71,] -0.418  5.240 -0.354  2.828
 [72,] -0.284  3.240  0.708  2.180
 [73,] -1.268  5.297  0.866  1.411
 [74,] -0.156  2.030 -0.196 -0.035
 [75,]  0.952  1.389  3.233 -2.220
 [76,] -1.989  6.369  0.917  1.428
 [77,]  0.093  0.683  0.578  1.111
 [78,]  0.302  0.400 -0.085  0.569
 [79,] -1.066  2.636  0.463  0.113
 [80,] -0.244  1.852  0.636 -0.302
 [81,] -0.526  2.564  0.187  0.009
 [82,] -0.451  0.612  1.708 -1.390
 [83,]  0.105  1.090  1.035 -0.055
 [84,]  1.119 -2.750  0.791  0.257
 [85,]  0.033  3.527  0.356  0.377
 [86,]  0.762  0.202  0.764  0.941
 [87,]  0.196  0.015  1.249  0.516
 [88,] -0.681  0.654  0.376  0.366
 [89,]  0.552  2.060  0.889  1.919
 [90,]  0.788 -0.669  0.880 -0.203
 [91,] -0.214  2.262 -0.187 -0.232
 [92,]  0.105 -0.033  0.768 -0.255
 [93,]  1.066 -0.978  1.265 -0.184
 [94,] -1.013  2.216  0.689 -0.410
 [95,] -0.264  4.764  0.774  0.269
 [96,]  0.491  2.884  0.439  0.780
 [97,] -2.925  3.922 -0.165  0.042
 [98,] -1.674  5.025  0.954 -0.144
 [99,] -0.669  0.662  1.003  0.350
[100,]  1.212 -2.157  1.060 -0.276
[101,]  0.585  1.721  0.803  1.665
[102,]  0.888  0.217  0.996  0.259
[103,]  0.529 -1.077  0.124 -0.086
[104,]  0.546  1.078  0.840  2.319
[105,] -1.607  5.950  1.092  0.158
[106,] -0.320  0.641  1.072  2.347
[107,]  0.144  1.053  1.040  1.013
[108,] -0.098  3.362 -0.949  1.745
[109,] -0.797  4.272 -1.346  1.951
[110,]  1.249  1.385  2.497  0.018
[111,]  0.501 -0.031  0.252  0.140
[112,] -2.643  8.383  2.535 -0.581
[113,] -0.161  1.451  2.073  0.796
[114,]  0.051  0.833  0.698  1.067
[115,] -0.174  2.392  1.208  0.606
[116,]  0.378  0.058  0.716 -0.178
[117,]  0.338  0.351  0.434  0.313
[118,] -0.142  3.376 -0.971  1.627
[119,]  0.782 -0.200  0.573  0.013
[120,]  1.780 -3.220  0.838  0.328
[121,]  1.342 -2.284  1.100  1.955
[122,]  1.491 -2.356  1.105  0.626
[123,]  1.140 -0.315  1.026 -0.351
[124,]  0.284  1.480  0.780  0.091
[125,] -0.502  0.769  2.149  0.825
[126,] -0.050  0.018  0.570 -0.247
[127,] -0.410  3.242 -0.920  0.607
[128,]  0.217 -0.036  0.424  0.067
[129,] -0.466  0.790  1.449 -0.222
[130,]  0.954 -1.565  0.497  0.669
[131,]  0.213 -0.062  1.314  0.059
[132,] -0.369  3.110 -0.238  2.146
[133,]  0.353  1.007  1.292  1.846
[134,]  0.025  0.551  1.002  0.317
[135,]  1.058 -0.160  1.025 -0.596
[136,] -1.327  3.921  0.376  1.064
[137,] -0.074  1.259  0.851  0.543
[138,] -0.528  0.540  0.905 -0.061
[139,]  1.196 -1.430  1.056  1.167
[140,]  0.042  0.431  0.814  2.098
[141,]  0.241  2.512  0.307  1.499
[142,]  0.715 -2.004  0.746 -0.205
[143,]  0.373 -0.400  0.779 -1.001
[144,]  1.310  1.375  1.167  1.110
[145,]  0.526 -0.573  0.393  0.078
[146,]  0.704 -2.016  0.763  0.883
[147,] -1.766  5.358  0.965  0.444
[148,]  0.220  1.673  0.984  1.022
[149,]  1.004 -2.193  0.899 -0.790
[150,] -0.500  0.783  1.950  1.731
[151,] -6.888 12.921  9.572 -0.212
[152,]  2.161 -3.225  0.969  0.725
[153,] -1.556  4.232  0.757  0.142
[154,] -0.810  6.791  1.245  1.396
[155,]  0.110  1.048  0.707  0.244
[156,] -0.323  1.545  0.703 -0.893
[157,] -0.261  0.396  0.551  0.371
[158,] -0.676  6.750 -0.874  0.451
[159,]  0.763  1.698  0.900  1.280
[160,]  0.682 -1.729  1.100  0.435
[161,] -0.475  2.188  0.169  0.647
[162,]  0.540 -1.636  1.062  0.195
[163,] -0.160  0.379  0.761  1.335
[164,]  0.892 -0.215  0.934  0.607
[165,] -0.797  1.969  0.742  0.028
[166,] -0.276  1.250  0.230  0.661
[167,] -0.283  1.668  1.534  2.569
[168,]  0.770  0.140  0.582  1.468
[169,]  0.194  0.248  1.114 -0.347
[170,] -0.759  5.726  0.686  2.136
[171,]  0.247 -1.898  1.133 -0.873
[172,] -0.337  2.111  0.297  0.605
[173,] -0.114  2.803  1.207  0.676
[174,] -5.685 11.204  8.348  2.855
[175,]  0.856 -0.748  0.395  0.851
[176,]  0.171  0.486  0.423  0.170
[177,]  0.258  2.563  1.131  0.361
[178,] -0.177  0.731  0.589 -0.343
[179,] -2.216  4.765  1.298  0.586
[180,]  0.663  2.037  3.156  0.468
[181,] -1.053  2.170  0.178  0.829
[182,]  1.718 -2.250  1.191 -1.384
[183,]  1.672 -0.546  1.919  1.692
[184,] -0.879  4.180  0.714  1.112
[185,] -0.249  2.112 -0.108  0.785
[186,] -0.790  1.764  0.703  0.974
[187,] -0.219  1.053  0.605  0.518
[188,] -1.195  3.543  0.344  0.211
[189,]  1.375 -0.028  1.339  0.543
[190,] -0.490  1.737  0.659  0.845
[191,] -0.659  0.487  1.909  0.818
[192,]  0.891 -1.557  0.990  0.286
[193,] -0.610  2.204  0.702  0.679
[194,]  0.395  2.523  0.249  2.379
[195,] -0.018  0.771 -0.157  0.562
[196,]  1.460 -2.351  1.099  0.625
[197,] -0.584  4.792  0.702  2.221
[198,] -0.359  1.154  0.504 -0.273
[199,]  0.234  2.652  0.888  1.224
[200,] -1.906  4.712  1.015  0.263
[201,] -0.915  4.139  0.799  0.619
[202,]  1.735  0.656  1.874  2.252
[203,]  0.568  0.209  0.486  1.002
[204,]  1.621 -1.413  0.964  2.180
[205,] -0.400  1.770  0.970  0.319
[206,] -4.031  4.916  0.072  0.370
[207,]  0.103 -0.113  0.667 -0.731
[208,] -0.256  0.481  0.532 -0.501
[209,]  0.563  2.118  0.385  1.510
[210,]  0.162 -0.215  1.053  0.522
[211,]  0.232  0.453  0.762 -1.114
[212,]  0.251  1.069  0.312  0.096
[213,]  0.706 -0.029  0.756  0.548
[214,]  0.298 -0.407  0.978  0.871
[215,] -0.398  1.067  0.563 -0.404
[216,]  0.608  2.956 -0.034  2.659
[217,] -0.423  1.389  0.501  0.546
[218,] -1.834  6.433  1.195  2.793
[219,]  0.473 -0.388  0.828  0.200
[220,]  1.358  1.580  1.342  2.739
[221,]  0.013  1.908  1.061 -1.308
[222,]  0.279 -0.122  1.433  0.305
[223,] -0.409  0.767  1.392 -0.646
[224,] -0.113  3.563  1.032  1.328
[225,] -0.414  6.433  0.483 -0.161
[226,] -0.554  0.532  0.422  0.085
[227,]  0.840  0.001  0.529 -0.214
[228,] -0.243 -0.369  1.461 -1.074
[229,] -0.443  3.552  0.645  2.112
[230,] -0.149  0.415  1.036 -0.695
[231,]  0.155 -0.137  0.030  0.080
[232,] -1.043  2.108  0.786  0.183
[233,] -0.086  1.453  0.743  0.677
[234,]  1.737 -2.949  0.874 -0.590
[235,] -0.114 -0.263  0.027 -0.112
[236,] -0.477  0.639  0.347 -0.295
[237,] -1.747  3.717  0.991 -0.367
[238,]  0.950 -0.117  1.488  1.260
[239,]  0.231  3.848 -0.549  0.258
[240,] -0.043  0.884  1.068  1.540
[241,] -1.839  4.391  1.295  0.290
[242,]  0.347 -1.076  1.733  0.290
[243,]  1.262 -0.249  1.157  0.125
[244,] -0.398  1.820  0.616  1.282
[245,]  0.442  3.972 -0.149  1.749
[246,] -1.032  1.343  0.268  0.589
[247,]  0.959 -1.582  0.524 -0.538
[248,]  0.327 -0.134  0.039  0.178
[249,]  0.008  0.168  0.913  0.923
[250,]  2.093 -1.871  1.426  1.461

> 
> gradTrue <- array( 0, c( n, 4, 2 ) )
> gradTrue[ , 1, 1 ] <- 5 * cos( 5 * z1 )
> gradTrue[ , 3, 1 ] <- 2 * z1
> gradTrue[ , 2, 2 ] <- exp( z2 )
> gradTrue[ , 3, 2 ] <- 1
> zData <- cbind( z1, z2 )
> # for( j in 1:2 ) {
> #    for( i in 1:3 ) {
> #       plot( zData[,j], grad[ , i, j ],
> #          main = paste( "d b", i-1, " / d z", j, sep = "" ) )
> #       points(  zData[,j], gradTrue[ , i, j ], col = "red" )
> #       cat( "Press <enter>\n")
> #       readLines( n = 1 )
> #    }
> # }
> all.equal( grad[ , 1, ] + grad[ , 2, ] * x1 + grad[ , 3, ] * x2, grad[ , 4, ] )
[1] TRUE
> 
> proc.time()
   user  system elapsed 
  6.329   0.054   6.406 
